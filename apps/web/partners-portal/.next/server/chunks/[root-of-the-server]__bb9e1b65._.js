module.exports=[31610,e=>e.a(async(t,o)=>{try{let t=await e.y("@react-pdf/renderer-2fa89ca58ff1f681");e.n(t),o()}catch(e){o(e)}},!0),99558,(e,t,o)=>{"use strict";t.exports=e.r(94358).vendored["react-rsc"].ReactJsxRuntime},50066,e=>e.a(async(t,o)=>{try{var r=e.i(99558),n=e.i(31610),a=t([n]);[n]=a.then?(await a)():a;let d=n.StyleSheet.create({page:{padding:40,fontFamily:"Helvetica",fontSize:10},header:{flexDirection:"row",justifyContent:"space-between",marginBottom:30,paddingBottom:20,borderBottomWidth:2,borderBottomColor:"#2563eb"},logo:{fontSize:24,fontWeight:"bold",color:"#2563eb"},headerRight:{textAlign:"right"},title:{fontSize:18,fontWeight:"bold",color:"#111827"},date:{fontSize:10,color:"#6b7280",marginTop:4},section:{marginBottom:20},sectionTitle:{fontSize:12,fontWeight:"bold",color:"#111827",marginBottom:10,paddingBottom:5,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},clientInfo:{backgroundColor:"#f3f4f6",padding:15,marginBottom:20},clientName:{fontSize:14,fontWeight:"bold",color:"#111827",marginBottom:5},clientDetail:{fontSize:10,color:"#4b5563",marginBottom:2},table:{marginBottom:20},tableHeader:{flexDirection:"row",backgroundColor:"#f3f4f6",padding:8,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},tableHeaderCell:{flex:1,fontSize:9,fontWeight:"bold",color:"#4b5563",textTransform:"uppercase"},tableRow:{flexDirection:"row",padding:8,borderBottomWidth:1,borderBottomColor:"#f3f4f6"},tableCell:{flex:1,fontSize:10,color:"#111827"},tableCellRight:{flex:1,fontSize:10,color:"#111827",textAlign:"right"},summaryBox:{marginTop:20,padding:15,backgroundColor:"#f9fafb",borderWidth:1,borderColor:"#e5e7eb"},summaryRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:8},summaryLabel:{fontSize:10,color:"#4b5563"},summaryValue:{fontSize:10,fontWeight:"bold",color:"#111827"},discountRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:8,paddingTop:8,borderTopWidth:1,borderTopColor:"#e5e7eb"},discountLabel:{fontSize:10,color:"#059669"},discountValue:{fontSize:10,fontWeight:"bold",color:"#059669"},totalRow:{flexDirection:"row",justifyContent:"space-between",marginTop:10,paddingTop:10,borderTopWidth:2,borderTopColor:"#2563eb"},totalLabel:{fontSize:14,fontWeight:"bold",color:"#111827"},totalValue:{fontSize:14,fontWeight:"bold",color:"#2563eb"},footer:{position:"absolute",bottom:40,left:40,right:40,borderTopWidth:1,borderTopColor:"#e5e7eb",paddingTop:15},footerText:{fontSize:9,color:"#6b7280",marginBottom:3},footerNote:{fontSize:8,color:"#9ca3af",marginTop:10,fontStyle:"italic"}});function i(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}function s(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}K`:e.toLocaleString()}let c={municipality:"Municipio",province:"Provincia/Estado",nation:"Nacional"};function l({quote:e,deal:t,partner:o}){var a;let l=[];return e.products.sovraGov.included&&l.push({description:"SovraGov - Plataforma de Gobierno Digital",detail:`${s(t.population)} hab. x ${i(e.products.sovraGov.pricePerInhabitant)}/hab`,price:e.products.sovraGov.annualPrice}),e.products.sovraId.included&&l.push({description:`SovraID - Plan ${{essentials:"Essentials",professional:"Professional",enterprise:"Enterprise"}[e.products.sovraId.plan]}`,detail:`${i(e.products.sovraId.monthlyPrice)}/mes x 12 meses`,price:e.products.sovraId.annualPrice}),e.services.walletImplementation&&l.push({description:"Implementacion Wallet",detail:"Servicio unico",price:e.services.walletPrice}),e.services.integrationHours>0&&l.push({description:"Horas de Integracion",detail:`${e.services.integrationHours} horas x ${i(e.services.integrationPricePerHour)}/hora`,price:e.services.integrationTotal}),(0,r.jsx)(n.Document,{children:(0,r.jsxs)(n.Page,{size:"A4",style:d.page,children:[(0,r.jsxs)(n.View,{style:d.header,children:[(0,r.jsx)(n.Text,{style:d.logo,children:"SOVRA"}),(0,r.jsxs)(n.View,{style:d.headerRight,children:[(0,r.jsx)(n.Text,{style:d.title,children:"Propuesta Comercial"}),(0,r.jsx)(n.Text,{style:d.date,children:(a=e.createdAt,new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}))}),(0,r.jsxs)(n.Text,{style:d.date,children:["Cotizacion #",e.id.split("-")[0]]})]})]}),(0,r.jsxs)(n.View,{style:d.clientInfo,children:[(0,r.jsx)(n.Text,{style:d.clientName,children:t.clientName}),(0,r.jsxs)(n.Text,{style:d.clientDetail,children:[t.country," - ",c[t.governmentLevel]]}),(0,r.jsxs)(n.Text,{style:d.clientDetail,children:["Poblacion: ",s(t.population)," habitantes"]}),(0,r.jsxs)(n.Text,{style:d.clientDetail,children:["Contacto: ",t.contactName," - ",t.contactRole]})]}),(0,r.jsxs)(n.View,{style:d.section,children:[(0,r.jsx)(n.Text,{style:d.sectionTitle,children:"Soluciones y Servicios"}),(0,r.jsxs)(n.View,{style:d.table,children:[(0,r.jsxs)(n.View,{style:d.tableHeader,children:[(0,r.jsx)(n.Text,{style:[d.tableHeaderCell,{flex:2}],children:"DESCRIPCION"}),(0,r.jsx)(n.Text,{style:[d.tableHeaderCell,{flex:1.5}],children:"DETALLE"}),(0,r.jsx)(n.Text,{style:[d.tableHeaderCell,{flex:1,textAlign:"right"}],children:"PRECIO"})]}),l.map((e,t)=>(0,r.jsxs)(n.View,{style:d.tableRow,children:[(0,r.jsx)(n.Text,{style:[d.tableCell,{flex:2}],children:e.description}),(0,r.jsx)(n.Text,{style:[d.tableCell,{flex:1.5}],children:e.detail}),(0,r.jsx)(n.Text,{style:[d.tableCellRight,{flex:1}],children:i(e.price)})]},t))]})]}),(0,r.jsxs)(n.View,{style:d.summaryBox,children:[(0,r.jsxs)(n.View,{style:d.summaryRow,children:[(0,r.jsx)(n.Text,{style:d.summaryLabel,children:"Subtotal"}),(0,r.jsx)(n.Text,{style:d.summaryValue,children:i(e.subtotal)})]}),e.discounts.totalDiscountPercent>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.View,{style:d.discountRow,children:[(0,r.jsxs)(n.Text,{style:d.discountLabel,children:["Descuento Partner ",o.tier.charAt(0).toUpperCase()+o.tier.slice(1)," (",e.discounts.baseDiscountPercent,"%)"]}),(0,r.jsxs)(n.Text,{style:d.discountValue,children:["-",i(e.subtotal*(e.discounts.baseDiscountPercent/100))]})]}),e.discounts.leadBonusPercent>0&&(0,r.jsxs)(n.View,{style:d.summaryRow,children:[(0,r.jsxs)(n.Text,{style:d.discountLabel,children:["Bonus Lead Generado (",e.discounts.leadBonusPercent,"%)"]}),(0,r.jsxs)(n.Text,{style:d.discountValue,children:["-",i(e.subtotal*(e.discounts.leadBonusPercent/100))]})]})]}),(0,r.jsxs)(n.View,{style:d.totalRow,children:[(0,r.jsx)(n.Text,{style:d.totalLabel,children:"TOTAL"}),(0,r.jsxs)(n.Text,{style:d.totalValue,children:[i(e.total)," USD/ano"]})]})]}),(0,r.jsxs)(n.View,{style:d.footer,children:[(0,r.jsxs)(n.Text,{style:d.footerText,children:["Partner: ",o.companyName]}),(0,r.jsxs)(n.Text,{style:d.footerText,children:["Contacto: ",o.email]}),(0,r.jsx)(n.Text,{style:d.footerNote,children:"Esta cotizacion es valida por 30 dias. Los precios estan expresados en dolares estadounidenses."})]})]})})}e.s(["QuotePDF",()=>l]),o()}catch(e){o(e)}},!1),58705,e=>e.a(async(t,o)=>{try{var r=e.i(34550),n=e.i(31610);e.i(21534);var a=e.i(52945);e.i(4287);var i=e.i(31967),s=e.i(50066),l=t([n,s]);async function d(e,{params:t}){try{let{quoteId:e}=await t,{partner:o}=await (0,a.requireSession)(),l=await (0,i.getQuote)(e);if(!l)return r.NextResponse.json({error:"Quote not found"},{status:404});if(l.partnerId!==o.id)return r.NextResponse.json({error:"Forbidden"},{status:403});let d=await (0,i.getDeal)(l.dealId);if(!d)return r.NextResponse.json({error:"Deal not found"},{status:404});let c=await (0,i.getPartner)(o.id);if(!c)return r.NextResponse.json({error:"Partner not found"},{status:404});let u=await (0,n.renderToBuffer)((0,s.QuotePDF)({quote:l,deal:d,partner:c})),p=`Cotizacion_${d.clientName.replace(/\s+/g,"_")}_v${l.version}.pdf`,h=new Uint8Array(u);return new r.NextResponse(h,{status:200,headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${p}"`}})}catch(e){if(e instanceof Error&&"Unauthorized"===e.message)return r.NextResponse.json({error:"Unauthorized"},{status:401});return console.error("Generate PDF error:",e),r.NextResponse.json({error:"Internal server error"},{status:500})}}[n,s]=l.then?(await l)():l,e.s(["GET",()=>d]),o()}catch(e){o(e)}},!1),56982,e=>e.a(async(t,o)=>{try{var r=e.i(72305),n=e.i(89013),a=e.i(88387),i=e.i(77950),s=e.i(30739),l=e.i(43703),d=e.i(58601),c=e.i(59251),u=e.i(12242),p=e.i(6002),h=e.i(92234),f=e.i(45043),x=e.i(18348),m=e.i(85936),b=e.i(72254),g=e.i(93695);e.i(24887);var y=e.i(42277),w=e.i(58705),R=t([w]);[w]=R.then?(await R)():R;let C=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/partners/quotes/[quoteId]/pdf/route",pathname:"/api/partners/quotes/[quoteId]/pdf",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/partners-portal/src/app/api/partners/quotes/[quoteId]/pdf/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:j,workUnitAsyncStorage:S,serverHooks:E}=C;function v(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:S})}async function T(e,t,o){C.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/partners/quotes/[quoteId]/pdf/route";r=r.replace(/\/index$/,"")||"/";let a=await C.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!a)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:w,params:R,nextConfig:v,parsedUrl:T,isDraftMode:j,prerenderManifest:S,routerServerContext:E,isOnDemandRevalidate:P,revalidateOnlyGenerated:D,resolvedPathname:N,clientReferenceManifest:A,serverActionsManifest:I}=a,B=(0,d.normalizeAppPath)(r),H=!!(S.dynamicRoutes[B]||S.routes[N]),z=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,T,!1):t.end("This page could not be found"),null);if(H&&!j){let e=!!S.routes[N],t=S.dynamicRoutes[B];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await z();throw new g.NoFallbackError}}let O=null;!H||C.isDev||j||(O=N,O="/index"===O?"/":O);let V=!0===C.isDev||!H,q=H&&!V;I&&A&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:A,serverActionsManifest:I});let U=e.method||"GET",_=(0,s.getTracer)(),L=_.getActiveScopeSpan(),W={params:R,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:V,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r,n)=>C.onRequestError(e,t,r,n,E)},sharedContext:{buildId:w}},$=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),k=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let a=async e=>C.handle(k,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=_.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=o.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${r}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&P&&D&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await a(i);e.fetchMetrics=W.renderOpts.fetchMetrics;let s=W.renderOpts.pendingWaitUntil;s&&o.waitUntil&&(o.waitUntil(s),s=void 0);let d=W.renderOpts.collectedTags;if(!H)return await (0,f.sendResponse)($,F,r,W.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,x.toNodeOutgoingHttpHeaders)(r.headers);d&&(t[b.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=b.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,n=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=b.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},!1,E),t}},u=await C.handleResponse({req:e,nextConfig:v,cacheKey:O,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:D,responseGenerator:c,waitUntil:o.waitUntil,isMinimalMode:l});if(!H)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),j&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,x.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&H||p.delete(b.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)($,F,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};L?await d(L):await _.withPropagatedContext(e.headers,()=>_.trace(p.BaseServerSpan.handleRequest,{spanName:`${U} ${r}`,kind:s.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:B,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},!1,E),H)throw t;return await (0,f.sendResponse)($,F,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>v,"routeModule",()=>C,"serverHooks",()=>E,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>S]),o()}catch(e){o(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__bb9e1b65._.js.map