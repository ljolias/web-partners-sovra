{"version":3,"sources":["../../../../../../apps/web/partners-portal/src/lib/redis/operations.ts","../../../../../../apps/web/partners-portal/src/lib/redis/keys.ts"],"sourcesContent":["import { redis } from './client';\nimport { keys, TTL } from './keys';\nimport type {\n  Partner,\n  PartnerTier,\n  PartnerCredential,\n  CredentialStatus,\n  User,\n  Session,\n  Deal,\n  DealStage,\n  DealStatus,\n  Quote,\n  PricingConfig,\n  TrainingModule,\n  TrainingProgress,\n  TrainingCourse,\n  Certification,\n  LegalDocument,\n  LegalSignature,\n  CopilotSession,\n  CopilotMessage,\n  Commission,\n  MEDDICScores,\n  DocumentCategory,\n  DocumentStatus,\n  DocumentAuditEvent,\n  LegacyLegalDocument,\n  AuditLog,\n  AuditAction,\n} from '@/types';\n\n// Helper to convert objects to Redis-compatible format\nfunction toRedisHash<T extends object>(obj: T): Record<string, string | number | boolean> {\n  const result: Record<string, string | number | boolean> = {};\n  for (const [key, value] of Object.entries(obj)) {\n    if (value === null || value === undefined) {\n      result[key] = '';\n    } else if (typeof value === 'object') {\n      result[key] = JSON.stringify(value);\n    } else {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n\n// Generate unique IDs\nexport function generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n}\n\n// ============ Partner Operations ============\n\nexport async function getPartner(id: string): Promise<Partner | null> {\n  const partner = await redis.hgetall(keys.partner(id)) as Partner | null;\n  if (!partner || !partner.id) return null;\n  // Parse numbers\n  if (typeof partner.rating === 'string') partner.rating = parseFloat(partner.rating);\n  if (typeof partner.totalDeals === 'string') partner.totalDeals = parseInt(partner.totalDeals, 10);\n  if (typeof partner.wonDeals === 'string') partner.wonDeals = parseInt(partner.wonDeals, 10);\n  if (typeof partner.totalRevenue === 'string') partner.totalRevenue = parseFloat(partner.totalRevenue);\n  // Parse certifications if JSON\n  if (typeof partner.certifications === 'string' && partner.certifications) {\n    partner.certifications = JSON.parse(partner.certifications);\n  }\n  return partner;\n}\n\nexport async function createPartner(partner: Partner): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  const partnerData = {\n    ...partner,\n    certifications: partner.certifications ? JSON.stringify(partner.certifications) : '',\n  };\n\n  pipeline.hset(keys.partner(partner.id), toRedisHash(partnerData));\n\n  // Add to tier index\n  pipeline.zadd(keys.partnersByTier(partner.tier), {\n    score: partner.rating,\n    member: partner.id,\n  });\n\n  // Add to status index\n  pipeline.sadd(keys.partnersByStatus(partner.status), partner.id);\n\n  // Add to country index\n  if (partner.country) {\n    pipeline.sadd(keys.partnersByCountry(partner.country), partner.id);\n  }\n\n  // Add to all partners sorted by creation time\n  pipeline.zadd(keys.allPartners(), {\n    score: new Date(partner.createdAt).getTime(),\n    member: partner.id,\n  });\n\n  await pipeline.exec();\n}\n\nexport async function getAllPartners(limit = 100): Promise<Partner[]> {\n  // First try the allPartners index\n  let partnerIds = await redis.zrange<string[]>(keys.allPartners(), 0, limit - 1, { rev: true });\n\n  // If empty, scan for partner keys (for existing data)\n  if (!partnerIds.length) {\n    const partnerKeys = await redis.keys('partner:*');\n    partnerIds = partnerKeys\n      .filter(k => !k.includes(':') || k.split(':').length === 2) // Only partner:{id} keys\n      .filter(k => !k.includes('users') && !k.includes('deals') && !k.includes('legal'))\n      .map(k => k.replace('partner:', ''));\n  }\n\n  if (!partnerIds.length) return [];\n\n  const partners = await Promise.all(partnerIds.map(id => getPartner(id)));\n  return partners.filter((p): p is Partner => p !== null);\n}\n\nexport async function getPartnersByStatus(status: 'active' | 'suspended'): Promise<Partner[]> {\n  const partnerIds = await redis.smembers<string[]>(keys.partnersByStatus(status));\n  if (!partnerIds.length) return [];\n  const partners = await Promise.all(partnerIds.map(id => getPartner(id)));\n  return partners.filter((p): p is Partner => p !== null);\n}\n\nexport async function getPartnersByTier(tier: PartnerTier): Promise<Partner[]> {\n  const partnerIds = await redis.zrange<string[]>(keys.partnersByTier(tier), 0, -1);\n  if (!partnerIds.length) return [];\n  const partners = await Promise.all(partnerIds.map(id => getPartner(id)));\n  return partners.filter((p): p is Partner => p !== null);\n}\n\nexport async function getPartnersByCountry(country: string): Promise<Partner[]> {\n  const partnerIds = await redis.smembers<string[]>(keys.partnersByCountry(country));\n  if (!partnerIds.length) return [];\n  const partners = await Promise.all(partnerIds.map(id => getPartner(id)));\n  return partners.filter((p): p is Partner => p !== null);\n}\n\nexport async function updatePartner(id: string, updates: Partial<Partner>): Promise<void> {\n  const partner = await getPartner(id);\n  if (!partner) throw new Error('Partner not found');\n\n  const pipeline = redis.pipeline();\n\n  const updateData: Record<string, unknown> = { ...updates, updatedAt: new Date().toISOString() };\n  if (updates.certifications) updateData.certifications = JSON.stringify(updates.certifications);\n\n  pipeline.hset(keys.partner(id), toRedisHash(updateData as Record<string, unknown>));\n\n  // Update tier index if changed\n  if (updates.tier && updates.tier !== partner.tier) {\n    pipeline.zrem(keys.partnersByTier(partner.tier), id);\n    pipeline.zadd(keys.partnersByTier(updates.tier), {\n      score: updates.rating ?? partner.rating,\n      member: id,\n    });\n  }\n\n  // Update status index if changed\n  if (updates.status && updates.status !== partner.status) {\n    pipeline.srem(keys.partnersByStatus(partner.status), id);\n    pipeline.sadd(keys.partnersByStatus(updates.status), id);\n  }\n\n  // Update country index if changed\n  if (updates.country && updates.country !== partner.country) {\n    if (partner.country) {\n      pipeline.srem(keys.partnersByCountry(partner.country), id);\n    }\n    pipeline.sadd(keys.partnersByCountry(updates.country), id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function suspendPartner(\n  id: string,\n  suspendedBy: string,\n  reason: string\n): Promise<void> {\n  await updatePartner(id, {\n    status: 'suspended',\n    suspendedAt: new Date().toISOString(),\n    suspendedBy,\n    suspendedReason: reason,\n  });\n}\n\nexport async function reactivatePartner(id: string): Promise<void> {\n  const partner = await getPartner(id);\n  if (!partner) throw new Error('Partner not found');\n\n  const pipeline = redis.pipeline();\n\n  // Clear suspension fields and set active\n  pipeline.hset(keys.partner(id), toRedisHash({\n    status: 'active',\n    suspendedAt: '',\n    suspendedBy: '',\n    suspendedReason: '',\n    updatedAt: new Date().toISOString(),\n  }));\n\n  // Update status index\n  pipeline.srem(keys.partnersByStatus('suspended'), id);\n  pipeline.sadd(keys.partnersByStatus('active'), id);\n\n  await pipeline.exec();\n}\n\nexport async function deletePartner(id: string): Promise<void> {\n  const partner = await getPartner(id);\n  if (!partner) throw new Error('Partner not found');\n\n  const pipeline = redis.pipeline();\n\n  // Delete partner hash\n  pipeline.del(keys.partner(id));\n\n  // Remove from all indexes\n  pipeline.zrem(keys.allPartners(), id);\n  pipeline.zrem(keys.partnersByTier(partner.tier), id);\n  pipeline.srem(keys.partnersByStatus(partner.status), id);\n  if (partner.country) {\n    pipeline.srem(keys.partnersByCountry(partner.country), id);\n  }\n\n  // Get and delete all partner deals\n  const dealIds = await redis.zrange<string[]>(keys.partnerDeals(id), 0, -1);\n  for (const dealId of dealIds) {\n    pipeline.del(`deal:${dealId}`);\n    pipeline.zrem(keys.allDeals(), dealId);\n  }\n  pipeline.del(keys.partnerDeals(id));\n\n  // Get and delete all partner credentials\n  const credentialIds = await redis.smembers<string[]>(keys.partnerCredentials(id));\n  for (const credId of credentialIds) {\n    pipeline.del(keys.partnerCredential(credId));\n  }\n  pipeline.del(keys.partnerCredentials(id));\n\n  // Delete partner users\n  const userIds = await redis.smembers<string[]>(keys.partnerUsers(id));\n  for (const userId of userIds) {\n    const user = await redis.hgetall(`user:${userId}`) as { email?: string } | null;\n    if (user?.email) {\n      pipeline.del(`user:email:${user.email}`);\n    }\n    pipeline.del(`user:${userId}`);\n  }\n  pipeline.del(keys.partnerUsers(id));\n\n  // Delete partner legal documents\n  pipeline.del(`partner:${id}:legal:documents`);\n  pipeline.del(`partner:${id}:signatures`);\n\n  // Delete partner certifications\n  pipeline.del(`partner:${id}:certifications`);\n\n  // Delete partner commissions\n  pipeline.del(`partner:${id}:commissions`);\n\n  await pipeline.exec();\n}\n\nexport async function getPartnerStats(partnerId: string): Promise<{\n  totalDeals: number;\n  wonDeals: number;\n  lostDeals: number;\n  pendingDeals: number;\n  totalRevenue: number;\n  credentialsCount: number;\n  activeCredentials: number;\n}> {\n  const [deals, credentials] = await Promise.all([\n    getPartnerDeals(partnerId),\n    getPartnerCredentials(partnerId),\n  ]);\n\n  const wonDeals = deals.filter(d => d.status === 'closed_won').length;\n  const lostDeals = deals.filter(d => d.status === 'closed_lost').length;\n  const pendingDeals = deals.filter(d => !['closed_won', 'closed_lost', 'rejected'].includes(d.status)).length;\n\n  return {\n    totalDeals: deals.length,\n    wonDeals,\n    lostDeals,\n    pendingDeals,\n    totalRevenue: 0, // Would need quote data to calculate\n    credentialsCount: credentials.length,\n    activeCredentials: credentials.filter(c => c.status === 'active').length,\n  };\n}\n\n// ============ User Operations ============\n\nexport async function getUser(id: string): Promise<User | null> {\n  const user = await redis.hgetall(keys.user(id)) as User | null;\n  if (!user || !user.id) return null;\n  return user;\n}\n\nexport async function getUserByEmail(email: string): Promise<User | null> {\n  const userId = await redis.get<string>(keys.userByEmail(email));\n  if (!userId) return null;\n  return getUser(userId);\n}\n\nexport async function createUser(user: User): Promise<void> {\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.user(user.id), toRedisHash(user));\n  pipeline.set(keys.userByEmail(user.email), user.id);\n  pipeline.sadd(keys.partnerUsers(user.partnerId), user.id);\n  await pipeline.exec();\n}\n\nexport async function updateUser(id: string, updates: Partial<User>): Promise<void> {\n  await redis.hset(keys.user(id), toRedisHash({ ...updates, updatedAt: new Date().toISOString() }));\n}\n\nexport async function getPartnerUsers(partnerId: string): Promise<User[]> {\n  const userIds = await redis.smembers<string[]>(keys.partnerUsers(partnerId));\n  if (!userIds.length) return [];\n  const users = await Promise.all(userIds.map((id) => getUser(id)));\n  return users.filter((u): u is User => u !== null);\n}\n\n// ============ Session Operations ============\n\nexport async function createSession(userId: string, partnerId: string): Promise<Session> {\n  const session: Session = {\n    id: generateId(),\n    userId,\n    partnerId,\n    expiresAt: new Date(Date.now() + TTL.session * 1000).toISOString(),\n    createdAt: new Date().toISOString(),\n  };\n  await redis.hset(keys.session(session.id), toRedisHash(session));\n  await redis.expire(keys.session(session.id), TTL.session);\n  return session;\n}\n\nexport async function getSession(id: string): Promise<Session | null> {\n  const session = await redis.hgetall(keys.session(id)) as Session | null;\n  if (!session || !session.id) return null;\n  if (new Date(session.expiresAt) < new Date()) {\n    await deleteSession(id);\n    return null;\n  }\n  return session;\n}\n\nexport async function deleteSession(id: string): Promise<void> {\n  await redis.del(keys.session(id));\n}\n\n// ============ Deal Operations ============\n\nexport async function getDeal(id: string): Promise<Deal | null> {\n  const deal = await redis.hgetall(keys.deal(id)) as Deal | null;\n  if (!deal || !deal.id) return null;\n  // Parse population as number if stored as string\n  if (typeof deal.population === 'string') {\n    deal.population = parseInt(deal.population, 10);\n  }\n  // Parse boolean if stored as string\n  if (typeof deal.partnerGeneratedLead === 'string') {\n    deal.partnerGeneratedLead = deal.partnerGeneratedLead === 'true';\n  }\n  return deal;\n}\n\nexport async function getPartnerDeals(partnerId: string, limit = 50): Promise<Deal[]> {\n  const dealIds = await redis.zrange<string[]>(keys.partnerDeals(partnerId), 0, limit - 1, {\n    rev: true,\n  });\n  if (!dealIds.length) return [];\n\n  const deals = await Promise.all(dealIds.map((id) => getDeal(id)));\n  return deals.filter((d): d is Deal => d !== null);\n}\n\nexport async function createDeal(deal: Deal): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  pipeline.hset(keys.deal(deal.id), toRedisHash(deal));\n\n  // Add to partner's deals sorted by creation time\n  pipeline.zadd(keys.partnerDeals(deal.partnerId), {\n    score: new Date(deal.createdAt).getTime(),\n    member: deal.id,\n  });\n\n  // Add to all deals index\n  pipeline.zadd(keys.allDeals(), {\n    score: new Date(deal.createdAt).getTime(),\n    member: deal.id,\n  });\n\n  // Add to status index\n  pipeline.sadd(keys.dealsByStatus(deal.status), deal.id);\n\n  await pipeline.exec();\n}\n\nexport async function updateDeal(id: string, updates: Partial<Deal>): Promise<void> {\n  const deal = await getDeal(id);\n  if (!deal) throw new Error('Deal not found');\n\n  const pipeline = redis.pipeline();\n\n  const updateData: Record<string, unknown> = { ...updates, updatedAt: new Date().toISOString() };\n\n  pipeline.hset(keys.deal(id), toRedisHash(updateData as Record<string, unknown>));\n\n  // Update status index if changed\n  if (updates.status && updates.status !== deal.status) {\n    pipeline.srem(keys.dealsByStatus(deal.status), id);\n    pipeline.sadd(keys.dealsByStatus(updates.status), id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function getDealsByStatus(status: DealStatus): Promise<Deal[]> {\n  const dealIds = await redis.smembers<string[]>(keys.dealsByStatus(status));\n  if (!dealIds.length) return [];\n  const deals = await Promise.all(dealIds.map((id) => getDeal(id)));\n  return deals.filter((d): d is Deal => d !== null);\n}\n\nexport async function getAllDeals(limit = 100): Promise<Deal[]> {\n  const dealIds = await redis.zrange<string[]>(keys.allDeals(), 0, limit - 1, {\n    rev: true,\n  });\n  if (!dealIds.length) return [];\n  const deals = await Promise.all(dealIds.map((id) => getDeal(id)));\n  return deals.filter((d): d is Deal => d !== null);\n}\n\n// Legacy function - kept for backward compatibility\nexport async function checkDomainConflict(domain: string, excludeDealId?: string): Promise<string[]> {\n  const existingDealIds = await redis.smembers<string[]>(keys.dealsByDomain(domain.toLowerCase()));\n  if (excludeDealId) {\n    return existingDealIds.filter((id) => id !== excludeDealId);\n  }\n  return existingDealIds;\n}\n\nexport async function getDealsByStage(stage: DealStage): Promise<Deal[]> {\n  const dealIds = await redis.smembers<string[]>(keys.dealsByStage(stage));\n  if (!dealIds.length) return [];\n  const deals = await Promise.all(dealIds.map((id) => getDeal(id)));\n  return deals.filter((d): d is Deal => d !== null);\n}\n\n// ============ Training Operations ============\n\nexport async function getTrainingModule(id: string): Promise<TrainingModule | null> {\n  const module = await redis.hgetall(keys.trainingModule(id)) as TrainingModule | null;\n  if (!module || !module.id) return null;\n  // Parse JSON fields\n  if (typeof module.title === 'string') module.title = JSON.parse(module.title);\n  if (typeof module.description === 'string') module.description = JSON.parse(module.description);\n  if (typeof module.content === 'string') module.content = JSON.parse(module.content);\n  if (typeof module.quiz === 'string') module.quiz = JSON.parse(module.quiz);\n  return module;\n}\n\nexport async function getAllTrainingModules(): Promise<TrainingModule[]> {\n  const moduleIds = await redis.smembers<string[]>(keys.trainingModules());\n  if (!moduleIds.length) return [];\n  const modules = await Promise.all(moduleIds.map((id) => getTrainingModule(id)));\n  return modules.filter((m): m is TrainingModule => m !== null).sort((a, b) => a.order - b.order);\n}\n\nexport async function createTrainingModule(module: TrainingModule): Promise<void> {\n  const moduleData = {\n    ...module,\n    title: JSON.stringify(module.title),\n    description: JSON.stringify(module.description),\n    content: JSON.stringify(module.content),\n    quiz: JSON.stringify(module.quiz),\n  };\n\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.trainingModule(module.id), toRedisHash(moduleData));\n  pipeline.sadd(keys.trainingModules(), module.id);\n  await pipeline.exec();\n}\n\nexport async function getUserTrainingProgress(userId: string): Promise<Record<string, TrainingProgress>> {\n  const progress = await redis.hgetall(keys.userTrainingProgress(userId)) as Record<string, string> | null;\n  if (!progress) return {};\n\n  const parsed: Record<string, TrainingProgress> = {};\n  for (const [moduleId, data] of Object.entries(progress)) {\n    parsed[moduleId] = typeof data === 'string' ? JSON.parse(data) : data;\n  }\n  return parsed;\n}\n\nexport async function updateTrainingProgress(userId: string, progress: TrainingProgress): Promise<void> {\n  await redis.hset(keys.userTrainingProgress(userId), {\n    [progress.moduleId]: JSON.stringify(progress),\n  });\n}\n\n// ============ Certification Operations ============\n\nexport async function getCertification(id: string): Promise<Certification | null> {\n  const cert = await redis.hgetall(keys.certification(id)) as Certification | null;\n  if (!cert || !cert.id) return null;\n  return cert;\n}\n\nexport async function getUserCertifications(userId: string): Promise<Certification[]> {\n  const certIds = await redis.smembers<string[]>(keys.userCertifications(userId));\n  if (!certIds.length) return [];\n  const certs = await Promise.all(certIds.map((id) => getCertification(id)));\n  return certs.filter((c): c is Certification => c !== null);\n}\n\nexport async function createCertification(cert: Certification): Promise<void> {\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.certification(cert.id), toRedisHash(cert));\n  pipeline.sadd(keys.userCertifications(cert.userId), cert.id);\n  pipeline.sadd(keys.partnerCertifications(cert.partnerId), cert.id);\n  await pipeline.exec();\n}\n\nexport async function hasValidCertification(userId: string): Promise<boolean> {\n  const certs = await getUserCertifications(userId);\n  return certs.some(\n    (cert) => cert.status === 'active' && new Date(cert.expiresAt) > new Date()\n  );\n}\n\n// ============ Legal Operations (Legacy) ============\n\nexport async function getLegalDocument(id: string): Promise<LegacyLegalDocument | null> {\n  const doc = await redis.hgetall(keys.legalDocument(id)) as LegacyLegalDocument | null;\n  if (!doc || !doc.id) return null;\n  if (typeof doc.title === 'string') doc.title = JSON.parse(doc.title);\n  if (typeof doc.content === 'string') doc.content = JSON.parse(doc.content);\n  return doc;\n}\n\nexport async function getAllLegalDocuments(): Promise<LegacyLegalDocument[]> {\n  const docIds = await redis.smembers<string[]>(keys.legalDocuments());\n  if (!docIds.length) return [];\n  const docs = await Promise.all(docIds.map((id) => getLegalDocument(id)));\n  return docs.filter((d): d is LegacyLegalDocument => d !== null);\n}\n\nexport async function createLegalDocument(doc: LegacyLegalDocument): Promise<void> {\n  const docData = {\n    ...doc,\n    title: JSON.stringify(doc.title),\n    content: JSON.stringify(doc.content),\n  };\n\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.legalDocument(doc.id), toRedisHash(docData));\n  pipeline.sadd(keys.legalDocuments(), doc.id);\n  await pipeline.exec();\n}\n\nexport async function signLegalDocument(signature: LegalSignature): Promise<void> {\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.legalSignature(signature.id), toRedisHash(signature));\n  pipeline.sadd(keys.userSignatures(signature.userId), signature.id);\n  pipeline.sadd(keys.partnerSignatures(signature.partnerId), signature.id);\n  await pipeline.exec();\n}\n\nexport async function getUserSignatures(userId: string): Promise<LegalSignature[]> {\n  const sigIds = await redis.smembers<string[]>(keys.userSignatures(userId));\n  if (!sigIds.length) return [];\n  const sigs = await Promise.all(\n    sigIds.map((id) => redis.hgetall(keys.legalSignature(id)) as Promise<LegalSignature | null>)\n  );\n  return sigs.filter((s): s is LegalSignature => s !== null && !!s.id);\n}\n\nexport async function hasSignedRequiredDocs(userId: string): Promise<boolean> {\n  const [docs, signatures] = await Promise.all([\n    getAllLegalDocuments(),\n    getUserSignatures(userId),\n  ]);\n\n  const requiredDocs = docs.filter((d) => d.requiredForDeals);\n  const signedDocIds = new Set(signatures.map((s) => s.documentId));\n\n  return requiredDocs.every((doc) => signedDocIds.has(doc.id));\n}\n\n// ============ Copilot Operations ============\n\nexport async function createCopilotSession(dealId: string, userId: string): Promise<CopilotSession> {\n  const session: CopilotSession = {\n    id: generateId(),\n    dealId,\n    userId,\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  };\n\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.copilotSession(session.id), toRedisHash(session));\n  pipeline.expire(keys.copilotSession(session.id), TTL.copilotSession);\n  pipeline.sadd(keys.dealCopilotSessions(dealId), session.id);\n  await pipeline.exec();\n\n  return session;\n}\n\nexport async function getCopilotSession(id: string): Promise<CopilotSession | null> {\n  const session = await redis.hgetall(keys.copilotSession(id)) as CopilotSession | null;\n  if (!session || !session.id) return null;\n  return session;\n}\n\nexport async function addCopilotMessage(sessionId: string, message: CopilotMessage): Promise<void> {\n  await redis.rpush(keys.copilotMessages(sessionId), JSON.stringify(message));\n}\n\nexport async function getCopilotMessages(sessionId: string): Promise<CopilotMessage[]> {\n  const messages = await redis.lrange<string>(keys.copilotMessages(sessionId), 0, -1);\n  return messages.map((m) => (typeof m === 'string' ? JSON.parse(m) : m));\n}\n\nexport async function updateCopilotMeddic(sessionId: string, scores: Partial<MEDDICScores>): Promise<void> {\n  await redis.hset(keys.copilotMeddic(sessionId), toRedisHash(scores as Record<string, number>));\n}\n\nexport async function getCopilotMeddic(sessionId: string): Promise<Partial<MEDDICScores>> {\n  return (await redis.hgetall(keys.copilotMeddic(sessionId))) as Partial<MEDDICScores> || {};\n}\n\n// ============ Commission Operations ============\n\nexport async function getCommission(id: string): Promise<Commission | null> {\n  const commission = await redis.hgetall(keys.commission(id)) as Commission | null;\n  if (!commission || !commission.id) return null;\n  return commission;\n}\n\nexport async function getPartnerCommissions(partnerId: string): Promise<Commission[]> {\n  const commIds = await redis.smembers<string[]>(keys.partnerCommissions(partnerId));\n  if (!commIds.length) return [];\n  const comms = await Promise.all(commIds.map((id) => getCommission(id)));\n  return comms.filter((c): c is Commission => c !== null);\n}\n\nexport async function createCommission(commission: Commission): Promise<void> {\n  const pipeline = redis.pipeline();\n  pipeline.hset(keys.commission(commission.id), toRedisHash(commission));\n  pipeline.sadd(keys.partnerCommissions(commission.partnerId), commission.id);\n  pipeline.set(keys.dealCommission(commission.dealId), commission.id);\n  await pipeline.exec();\n}\n\nexport async function updateCommission(id: string, updates: Partial<Commission>): Promise<void> {\n  await redis.hset(keys.commission(id), toRedisHash(updates as Record<string, unknown>));\n}\n\n// ============ Quote Operations ============\n\nexport async function getQuote(id: string): Promise<Quote | null> {\n  const quote = await redis.hgetall(keys.quote(id)) as Quote | null;\n  if (!quote || !quote.id) return null;\n  // Parse JSON fields\n  if (typeof quote.products === 'string') quote.products = JSON.parse(quote.products);\n  if (typeof quote.services === 'string') quote.services = JSON.parse(quote.services);\n  if (typeof quote.discounts === 'string') quote.discounts = JSON.parse(quote.discounts);\n  // Parse numbers\n  if (typeof quote.version === 'string') quote.version = parseInt(quote.version, 10);\n  if (typeof quote.subtotal === 'string') quote.subtotal = parseFloat(quote.subtotal);\n  if (typeof quote.totalDiscount === 'string') quote.totalDiscount = parseFloat(quote.totalDiscount);\n  if (typeof quote.total === 'string') quote.total = parseFloat(quote.total);\n  return quote;\n}\n\nexport async function getDealQuotes(dealId: string): Promise<Quote[]> {\n  const quoteIds = await redis.zrange<string[]>(keys.dealQuotes(dealId), 0, -1, {\n    rev: true,\n  });\n  if (!quoteIds.length) return [];\n  const quotes = await Promise.all(quoteIds.map((id) => getQuote(id)));\n  return quotes.filter((q): q is Quote => q !== null);\n}\n\nexport async function getPartnerQuotes(partnerId: string, limit = 50): Promise<Quote[]> {\n  const quoteIds = await redis.zrange<string[]>(keys.partnerQuotes(partnerId), 0, limit - 1, {\n    rev: true,\n  });\n  if (!quoteIds.length) return [];\n  const quotes = await Promise.all(quoteIds.map((id) => getQuote(id)));\n  return quotes.filter((q): q is Quote => q !== null);\n}\n\nexport async function createQuote(quote: Quote): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  const quoteData = {\n    ...quote,\n    products: JSON.stringify(quote.products),\n    services: JSON.stringify(quote.services),\n    discounts: JSON.stringify(quote.discounts),\n  };\n\n  pipeline.hset(keys.quote(quote.id), toRedisHash(quoteData));\n\n  // Add to deal's quotes sorted by version\n  pipeline.zadd(keys.dealQuotes(quote.dealId), {\n    score: quote.version,\n    member: quote.id,\n  });\n\n  // Add to partner's quotes sorted by creation time\n  pipeline.zadd(keys.partnerQuotes(quote.partnerId), {\n    score: new Date(quote.createdAt).getTime(),\n    member: quote.id,\n  });\n\n  await pipeline.exec();\n}\n\nexport async function updateQuote(id: string, updates: Partial<Quote>): Promise<void> {\n  const updateData: Record<string, unknown> = { ...updates, updatedAt: new Date().toISOString() };\n\n  // Serialize nested objects\n  if (updates.products) updateData.products = JSON.stringify(updates.products);\n  if (updates.services) updateData.services = JSON.stringify(updates.services);\n  if (updates.discounts) updateData.discounts = JSON.stringify(updates.discounts);\n\n  await redis.hset(keys.quote(id), toRedisHash(updateData as Record<string, unknown>));\n}\n\nexport async function getNextQuoteVersion(dealId: string): Promise<number> {\n  const quotes = await getDealQuotes(dealId);\n  if (!quotes.length) return 1;\n  return Math.max(...quotes.map(q => q.version)) + 1;\n}\n\n// ============ Pricing Config Operations ============\n\nconst DEFAULT_PRICING_CONFIG: PricingConfig = {\n  sovraGov: {\n    tiers: [\n      { maxPopulation: 100000, pricePerInhabitant: 0.50 },\n      { maxPopulation: 250000, pricePerInhabitant: 0.40 },\n      { maxPopulation: 500000, pricePerInhabitant: 0.32 },\n      { maxPopulation: 1000000, pricePerInhabitant: 0.26 },\n      { maxPopulation: 2500000, pricePerInhabitant: 0.20 },\n      { maxPopulation: 5000000, pricePerInhabitant: 0.16 },\n      { maxPopulation: 10000000, pricePerInhabitant: 0.13 },\n    ],\n  },\n  sovraId: {\n    essentials: { monthlyLimit: 10000, monthlyPrice: 1000 },\n    professional: { monthlyLimit: 30000, monthlyPrice: 2000 },\n    enterprise: { monthlyLimit: 50000, monthlyPrice: 3000 },\n  },\n  services: {\n    walletImplementation: 5000,\n    integrationHourlyRate: 150,\n  },\n  discounts: {\n    bronze: { base: 5, leadBonus: 0 },\n    silver: { base: 20, leadBonus: 10 },\n    gold: { base: 25, leadBonus: 15 },\n    platinum: { base: 30, leadBonus: 20 },\n  },\n};\n\nexport async function getPricingConfig(): Promise<PricingConfig> {\n  const config = await redis.get<string>(keys.pricingConfig());\n  if (!config) {\n    // Initialize with default config\n    await savePricingConfig(DEFAULT_PRICING_CONFIG);\n    return DEFAULT_PRICING_CONFIG;\n  }\n  return typeof config === 'string' ? JSON.parse(config) : config;\n}\n\nexport async function savePricingConfig(config: PricingConfig): Promise<void> {\n  await redis.set(keys.pricingConfig(), JSON.stringify(config));\n}\n\nexport async function updatePricingConfig(updates: Partial<PricingConfig>): Promise<PricingConfig> {\n  const current = await getPricingConfig();\n  const updated = { ...current, ...updates };\n  await savePricingConfig(updated);\n  return updated;\n}\n\nexport { DEFAULT_PRICING_CONFIG };\n\n// ============ Enhanced Legal Document Operations (V2) ============\n\nexport async function getLegalDocumentV2(id: string): Promise<LegalDocument | null> {\n  const doc = await redis.hgetall(keys.legalDocumentV2(id)) as LegalDocument | null;\n  if (!doc || !doc.id) return null;\n  // Parse JSON fields (handle empty strings)\n  if (typeof doc.docusignMetadata === 'string' && doc.docusignMetadata) {\n    doc.docusignMetadata = JSON.parse(doc.docusignMetadata);\n  } else {\n    doc.docusignMetadata = undefined;\n  }\n  if (typeof doc.uploadMetadata === 'string' && doc.uploadMetadata) {\n    doc.uploadMetadata = JSON.parse(doc.uploadMetadata);\n  } else {\n    doc.uploadMetadata = undefined;\n  }\n  // Parse numbers\n  if (typeof doc.version === 'string') doc.version = parseInt(doc.version, 10);\n  return doc;\n}\n\nexport async function getPartnerLegalDocuments(partnerId: string, limit = 100): Promise<LegalDocument[]> {\n  console.log('[Redis] Fetching documents for partner:', partnerId, 'key:', keys.partnerLegalDocuments(partnerId));\n  const docIds = await redis.zrange<string[]>(keys.partnerLegalDocuments(partnerId), 0, limit - 1, {\n    rev: true,\n  });\n  console.log('[Redis] Found document IDs:', docIds.length, docIds);\n  if (!docIds.length) return [];\n  const docs = await Promise.all(docIds.map((id) => getLegalDocumentV2(id)));\n  return docs.filter((d): d is LegalDocument => d !== null);\n}\n\nexport async function getAllLegalDocumentsV2(limit = 100): Promise<LegalDocument[]> {\n  const docIds = await redis.zrange<string[]>(keys.allLegalDocumentsV2(), 0, limit - 1, {\n    rev: true,\n  });\n  if (!docIds.length) return [];\n  const docs = await Promise.all(docIds.map((id) => getLegalDocumentV2(id)));\n  return docs.filter((d): d is LegalDocument => d !== null);\n}\n\nexport async function getLegalDocumentsByCategory(category: DocumentCategory, limit = 100): Promise<LegalDocument[]> {\n  const docIds = await redis.smembers<string[]>(keys.legalDocumentsByCategory(category));\n  if (!docIds.length) return [];\n  const docs = await Promise.all(docIds.map((id) => getLegalDocumentV2(id)));\n  return docs.filter((d): d is LegalDocument => d !== null).slice(0, limit);\n}\n\nexport async function getLegalDocumentsByStatus(status: DocumentStatus, limit = 100): Promise<LegalDocument[]> {\n  const docIds = await redis.smembers<string[]>(keys.legalDocumentsByStatus(status));\n  if (!docIds.length) return [];\n  const docs = await Promise.all(docIds.map((id) => getLegalDocumentV2(id)));\n  return docs.filter((d): d is LegalDocument => d !== null).slice(0, limit);\n}\n\nexport async function createLegalDocumentV2(doc: LegalDocument): Promise<void> {\n  console.log('[Redis] Creating legal document:', doc.id, 'for partner:', doc.partnerId);\n\n  const pipeline = redis.pipeline();\n\n  const docData = {\n    ...doc,\n    docusignMetadata: doc.docusignMetadata ? JSON.stringify(doc.docusignMetadata) : '',\n    uploadMetadata: doc.uploadMetadata ? JSON.stringify(doc.uploadMetadata) : '',\n  };\n\n  pipeline.hset(keys.legalDocumentV2(doc.id), toRedisHash(docData));\n\n  // Add to partner's documents sorted by creation time\n  pipeline.zadd(keys.partnerLegalDocuments(doc.partnerId), {\n    score: new Date(doc.createdAt).getTime(),\n    member: doc.id,\n  });\n\n  // Add to all documents index\n  pipeline.zadd(keys.allLegalDocumentsV2(), {\n    score: new Date(doc.createdAt).getTime(),\n    member: doc.id,\n  });\n\n  // Add to category index\n  pipeline.sadd(keys.legalDocumentsByCategory(doc.category), doc.id);\n\n  // Add to status index\n  pipeline.sadd(keys.legalDocumentsByStatus(doc.status), doc.id);\n\n  // If DocuSign document, create envelope mapping\n  if (doc.type === 'docusign' && doc.docusignMetadata?.envelopeId) {\n    pipeline.set(keys.docusignEnvelope(doc.docusignMetadata.envelopeId), doc.id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function updateLegalDocumentV2(id: string, updates: Partial<LegalDocument>): Promise<void> {\n  const doc = await getLegalDocumentV2(id);\n  if (!doc) throw new Error('Document not found');\n\n  const pipeline = redis.pipeline();\n\n  const updateData: Record<string, unknown> = { ...updates, updatedAt: new Date().toISOString() };\n\n  // Serialize nested objects\n  if (updates.docusignMetadata) updateData.docusignMetadata = JSON.stringify(updates.docusignMetadata);\n  if (updates.uploadMetadata) updateData.uploadMetadata = JSON.stringify(updates.uploadMetadata);\n\n  pipeline.hset(keys.legalDocumentV2(id), toRedisHash(updateData as Record<string, unknown>));\n\n  // Update status index if changed\n  if (updates.status && updates.status !== doc.status) {\n    pipeline.srem(keys.legalDocumentsByStatus(doc.status), id);\n    pipeline.sadd(keys.legalDocumentsByStatus(updates.status), id);\n  }\n\n  // Update category index if changed\n  if (updates.category && updates.category !== doc.category) {\n    pipeline.srem(keys.legalDocumentsByCategory(doc.category), id);\n    pipeline.sadd(keys.legalDocumentsByCategory(updates.category), id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function getLegalDocumentByEnvelopeId(envelopeId: string): Promise<LegalDocument | null> {\n  const docId = await redis.get<string>(keys.docusignEnvelope(envelopeId));\n  if (!docId) return null;\n  return getLegalDocumentV2(docId);\n}\n\n// ============ Document Audit Operations ============\n\nexport async function createDocumentAuditEvent(event: DocumentAuditEvent): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  pipeline.hset(keys.documentAuditEvent(event.id), toRedisHash(event));\n  pipeline.zadd(keys.documentAuditEvents(event.documentId), {\n    score: new Date(event.timestamp).getTime(),\n    member: event.id,\n  });\n\n  await pipeline.exec();\n}\n\nexport async function getDocumentAuditEvents(documentId: string, limit = 50): Promise<DocumentAuditEvent[]> {\n  const eventIds = await redis.zrange<string[]>(keys.documentAuditEvents(documentId), 0, limit - 1, {\n    rev: true,\n  });\n  if (!eventIds.length) return [];\n\n  const events = await Promise.all(\n    eventIds.map(async (id) => {\n      const event = await redis.hgetall(keys.documentAuditEvent(id)) as DocumentAuditEvent | null;\n      if (!event || !event.id) return null;\n      if (typeof event.details === 'string') event.details = JSON.parse(event.details);\n      return event;\n    })\n  );\n\n  return events.filter((e): e is DocumentAuditEvent => e !== null);\n}\n\nexport async function addDocumentAuditLog(\n  documentId: string,\n  action: DocumentAuditEvent['action'],\n  actor: { type: 'partner' | 'sovra' | 'system'; id?: string; name?: string },\n  details?: Record<string, unknown>,\n  request?: { ipAddress?: string; userAgent?: string }\n): Promise<void> {\n  const event: DocumentAuditEvent = {\n    id: generateId(),\n    documentId,\n    action,\n    actorType: actor.type,\n    actorId: actor.id,\n    actorName: actor.name,\n    details,\n    ipAddress: request?.ipAddress,\n    userAgent: request?.userAgent,\n    timestamp: new Date().toISOString(),\n  };\n\n  await createDocumentAuditEvent(event);\n}\n\n// ============ Partner Pending Documents ============\n\nexport async function getPartnerPendingDocuments(partnerId: string): Promise<LegalDocument[]> {\n  const docs = await getPartnerLegalDocuments(partnerId);\n  return docs.filter(\n    (doc) =>\n      doc.status === 'pending_signature' ||\n      (doc.type === 'upload' &&\n        doc.uploadMetadata?.verificationStatus === 'pending' &&\n        doc.uploadMetadata?.uploadedBy === 'partner')\n  );\n}\n\nexport async function getPartnerDocumentsRequiringAction(partnerId: string): Promise<{\n  pendingSignature: LegalDocument[];\n  expiringSOon: LegalDocument[];\n}> {\n  const docs = await getPartnerLegalDocuments(partnerId);\n  const now = new Date();\n  const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n\n  const pendingSignature = docs.filter(\n    (doc) => doc.status === 'pending_signature' || doc.status === 'partially_signed'\n  );\n\n  const expiringSOon = docs.filter((doc) => {\n    if (!doc.expirationDate || doc.status !== 'active') return false;\n    const expDate = new Date(doc.expirationDate);\n    return expDate > now && expDate <= thirtyDaysFromNow;\n  });\n\n  return { pendingSignature, expiringSOon };\n}\n\n// ============ Partner Credentials (SovraID) Operations ============\n\nexport async function getPartnerCredential(id: string): Promise<PartnerCredential | null> {\n  const credential = await redis.hgetall(keys.partnerCredential(id)) as PartnerCredential | null;\n  if (!credential || !credential.id) return null;\n  return credential;\n}\n\nexport async function getPartnerCredentials(partnerId: string, limit = 100): Promise<PartnerCredential[]> {\n  const credentialIds = await redis.zrange<string[]>(keys.partnerCredentials(partnerId), 0, limit - 1, {\n    rev: true,\n  });\n  if (!credentialIds.length) return [];\n  const credentials = await Promise.all(credentialIds.map((id) => getPartnerCredential(id)));\n  return credentials.filter((c): c is PartnerCredential => c !== null);\n}\n\nexport async function getCredentialsByStatus(status: CredentialStatus): Promise<PartnerCredential[]> {\n  const credentialIds = await redis.smembers<string[]>(keys.credentialsByStatus(status));\n  if (!credentialIds.length) return [];\n  const credentials = await Promise.all(credentialIds.map((id) => getPartnerCredential(id)));\n  return credentials.filter((c): c is PartnerCredential => c !== null);\n}\n\nexport async function getCredentialByEmail(email: string): Promise<PartnerCredential | null> {\n  const credentialId = await redis.get<string>(keys.credentialByEmail(email));\n  if (!credentialId) return null;\n  return getPartnerCredential(credentialId);\n}\n\nexport async function createPartnerCredential(credential: PartnerCredential): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  pipeline.hset(keys.partnerCredential(credential.id), toRedisHash(credential));\n\n  // Add to partner's credentials sorted by creation time\n  pipeline.zadd(keys.partnerCredentials(credential.partnerId), {\n    score: new Date(credential.createdAt).getTime(),\n    member: credential.id,\n  });\n\n  // Add to all credentials index\n  pipeline.zadd(keys.allCredentials(), {\n    score: new Date(credential.createdAt).getTime(),\n    member: credential.id,\n  });\n\n  // Add to status index\n  pipeline.sadd(keys.credentialsByStatus(credential.status), credential.id);\n\n  // Add email index\n  pipeline.set(keys.credentialByEmail(credential.holderEmail), credential.id);\n\n  await pipeline.exec();\n}\n\nexport async function updatePartnerCredential(id: string, updates: Partial<PartnerCredential>): Promise<void> {\n  const credential = await getPartnerCredential(id);\n  if (!credential) throw new Error('Credential not found');\n\n  const pipeline = redis.pipeline();\n\n  const updateData = { ...updates, updatedAt: new Date().toISOString() };\n  pipeline.hset(keys.partnerCredential(id), toRedisHash(updateData as Record<string, unknown>));\n\n  // Update status index if changed\n  if (updates.status && updates.status !== credential.status) {\n    pipeline.srem(keys.credentialsByStatus(credential.status), id);\n    pipeline.sadd(keys.credentialsByStatus(updates.status), id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function revokePartnerCredential(\n  id: string,\n  revokedBy: string,\n  reason: string\n): Promise<void> {\n  await updatePartnerCredential(id, {\n    status: 'revoked',\n    revokedAt: new Date().toISOString(),\n    revokedBy,\n    revokedReason: reason,\n  });\n}\n\nexport async function revokeAllPartnerCredentials(\n  partnerId: string,\n  revokedBy: string,\n  reason: string\n): Promise<void> {\n  const credentials = await getPartnerCredentials(partnerId);\n  const activeCredentials = credentials.filter(c => ['active', 'claimed', 'issued'].includes(c.status));\n\n  for (const credential of activeCredentials) {\n    await revokePartnerCredential(credential.id, revokedBy, reason);\n  }\n}\n\n// ============ Training Courses (Admin) Operations ============\n\nexport async function getTrainingCourse(id: string): Promise<TrainingCourse | null> {\n  const course = await redis.hgetall(keys.trainingCourse(id)) as TrainingCourse | null;\n  if (!course || !course.id) return null;\n  // Parse JSON fields\n  if (typeof course.title === 'string') course.title = JSON.parse(course.title);\n  if (typeof course.description === 'string') course.description = JSON.parse(course.description);\n  if (typeof course.modules === 'string') course.modules = JSON.parse(course.modules);\n  if (typeof course.requiredForTiers === 'string' && course.requiredForTiers) {\n    course.requiredForTiers = JSON.parse(course.requiredForTiers as unknown as string);\n  }\n  // Parse booleans\n  if (typeof course.isPublished === 'string') course.isPublished = course.isPublished === 'true';\n  if (typeof course.isRequired === 'string') course.isRequired = course.isRequired === 'true';\n  if (typeof course.certificateEnabled === 'string') course.certificateEnabled = course.certificateEnabled === 'true';\n  // Parse numbers\n  if (typeof course.duration === 'string') course.duration = parseInt(course.duration, 10);\n  if (typeof course.passingScore === 'string') course.passingScore = parseInt(course.passingScore, 10);\n  if (typeof course.order === 'string') course.order = parseInt(course.order, 10);\n  return course;\n}\n\nexport async function getAllTrainingCourses(): Promise<TrainingCourse[]> {\n  const courseIds = await redis.zrange<string[]>(keys.allTrainingCourses(), 0, -1, { rev: true });\n  if (!courseIds.length) return [];\n  const courses = await Promise.all(courseIds.map((id) => getTrainingCourse(id)));\n  return courses.filter((c): c is TrainingCourse => c !== null).sort((a, b) => a.order - b.order);\n}\n\nexport async function getPublishedTrainingCourses(): Promise<TrainingCourse[]> {\n  const courseIds = await redis.smembers<string[]>(keys.publishedTrainingCourses());\n  if (!courseIds.length) return [];\n  const courses = await Promise.all(courseIds.map((id) => getTrainingCourse(id)));\n  return courses.filter((c): c is TrainingCourse => c !== null).sort((a, b) => a.order - b.order);\n}\n\nexport async function getTrainingCoursesByCategory(category: string): Promise<TrainingCourse[]> {\n  const courseIds = await redis.smembers<string[]>(keys.trainingCoursesByCategory(category));\n  if (!courseIds.length) return [];\n  const courses = await Promise.all(courseIds.map((id) => getTrainingCourse(id)));\n  return courses.filter((c): c is TrainingCourse => c !== null).sort((a, b) => a.order - b.order);\n}\n\nexport async function createTrainingCourse(course: TrainingCourse): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  const courseData = {\n    ...course,\n    title: JSON.stringify(course.title),\n    description: JSON.stringify(course.description),\n    modules: JSON.stringify(course.modules),\n    requiredForTiers: course.requiredForTiers ? JSON.stringify(course.requiredForTiers) : '',\n  };\n\n  pipeline.hset(keys.trainingCourse(course.id), toRedisHash(courseData));\n\n  // Add to all courses sorted by order\n  pipeline.zadd(keys.allTrainingCourses(), {\n    score: course.order,\n    member: course.id,\n  });\n\n  // Add to category index\n  pipeline.sadd(keys.trainingCoursesByCategory(course.category), course.id);\n\n  // Add to published index if published\n  if (course.isPublished) {\n    pipeline.sadd(keys.publishedTrainingCourses(), course.id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function updateTrainingCourse(id: string, updates: Partial<TrainingCourse>): Promise<void> {\n  const course = await getTrainingCourse(id);\n  if (!course) throw new Error('Course not found');\n\n  const pipeline = redis.pipeline();\n\n  const updateData: Record<string, unknown> = { ...updates, updatedAt: new Date().toISOString() };\n  if (updates.title) updateData.title = JSON.stringify(updates.title);\n  if (updates.description) updateData.description = JSON.stringify(updates.description);\n  if (updates.modules) updateData.modules = JSON.stringify(updates.modules);\n  if (updates.requiredForTiers) updateData.requiredForTiers = JSON.stringify(updates.requiredForTiers);\n\n  pipeline.hset(keys.trainingCourse(id), toRedisHash(updateData as Record<string, unknown>));\n\n  // Update category index if changed\n  if (updates.category && updates.category !== course.category) {\n    pipeline.srem(keys.trainingCoursesByCategory(course.category), id);\n    pipeline.sadd(keys.trainingCoursesByCategory(updates.category), id);\n  }\n\n  // Update published index if changed\n  if (updates.isPublished !== undefined && updates.isPublished !== course.isPublished) {\n    if (updates.isPublished) {\n      pipeline.sadd(keys.publishedTrainingCourses(), id);\n    } else {\n      pipeline.srem(keys.publishedTrainingCourses(), id);\n    }\n  }\n\n  // Update order in sorted set if changed\n  if (updates.order !== undefined && updates.order !== course.order) {\n    pipeline.zadd(keys.allTrainingCourses(), {\n      score: updates.order,\n      member: id,\n    });\n  }\n\n  await pipeline.exec();\n}\n\nexport async function deleteTrainingCourse(id: string): Promise<void> {\n  const course = await getTrainingCourse(id);\n  if (!course) throw new Error('Course not found');\n\n  const pipeline = redis.pipeline();\n\n  pipeline.del(keys.trainingCourse(id));\n  pipeline.zrem(keys.allTrainingCourses(), id);\n  pipeline.srem(keys.trainingCoursesByCategory(course.category), id);\n  if (course.isPublished) {\n    pipeline.srem(keys.publishedTrainingCourses(), id);\n  }\n\n  await pipeline.exec();\n}\n\nexport async function publishTrainingCourse(id: string): Promise<void> {\n  await updateTrainingCourse(id, { isPublished: true });\n}\n\nexport async function unpublishTrainingCourse(id: string): Promise<void> {\n  await updateTrainingCourse(id, { isPublished: false });\n}\n\n// ============ Audit Log Operations ============\n\nexport async function createAuditLog(log: AuditLog): Promise<void> {\n  const pipeline = redis.pipeline();\n\n  const logData = {\n    ...log,\n    changes: log.changes ? JSON.stringify(log.changes) : '',\n    metadata: log.metadata ? JSON.stringify(log.metadata) : '',\n  };\n\n  pipeline.hset(keys.auditLog(log.id), toRedisHash(logData));\n\n  // Add to all logs sorted by timestamp\n  pipeline.zadd(keys.allAuditLogs(), {\n    score: new Date(log.timestamp).getTime(),\n    member: log.id,\n  });\n\n  // Add to entity index\n  pipeline.zadd(keys.auditLogsByEntity(log.entityType, log.entityId), {\n    score: new Date(log.timestamp).getTime(),\n    member: log.id,\n  });\n\n  // Add to action index\n  pipeline.sadd(keys.auditLogsByAction(log.action), log.id);\n\n  // Add to actor index\n  if (log.actorId) {\n    pipeline.zadd(keys.auditLogsByActor(log.actorId), {\n      score: new Date(log.timestamp).getTime(),\n      member: log.id,\n    });\n  }\n\n  await pipeline.exec();\n}\n\nexport async function getAuditLog(id: string): Promise<AuditLog | null> {\n  const log = await redis.hgetall(keys.auditLog(id)) as AuditLog | null;\n  if (!log || !log.id) return null;\n  // Parse JSON fields\n  if (typeof log.changes === 'string' && log.changes) log.changes = JSON.parse(log.changes);\n  if (typeof log.metadata === 'string' && log.metadata) log.metadata = JSON.parse(log.metadata);\n  return log;\n}\n\nexport async function getAllAuditLogs(limit = 100, offset = 0): Promise<AuditLog[]> {\n  const logIds = await redis.zrange<string[]>(keys.allAuditLogs(), offset, offset + limit - 1, {\n    rev: true,\n  });\n  if (!logIds.length) return [];\n  const logs = await Promise.all(logIds.map((id) => getAuditLog(id)));\n  return logs.filter((l): l is AuditLog => l !== null);\n}\n\nexport async function getAuditLogsByEntity(\n  entityType: string,\n  entityId: string,\n  limit = 50\n): Promise<AuditLog[]> {\n  const logIds = await redis.zrange<string[]>(\n    keys.auditLogsByEntity(entityType, entityId),\n    0,\n    limit - 1,\n    { rev: true }\n  );\n  if (!logIds.length) return [];\n  const logs = await Promise.all(logIds.map((id) => getAuditLog(id)));\n  return logs.filter((l): l is AuditLog => l !== null);\n}\n\nexport async function getAuditLogsByAction(action: AuditAction, limit = 50): Promise<AuditLog[]> {\n  const logIds = await redis.smembers<string[]>(keys.auditLogsByAction(action));\n  if (!logIds.length) return [];\n  const logs = await Promise.all(logIds.map((id) => getAuditLog(id)));\n  return logs\n    .filter((l): l is AuditLog => l !== null)\n    .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n    .slice(0, limit);\n}\n\nexport async function getAuditLogsByActor(actorId: string, limit = 50): Promise<AuditLog[]> {\n  const logIds = await redis.zrange<string[]>(keys.auditLogsByActor(actorId), 0, limit - 1, {\n    rev: true,\n  });\n  if (!logIds.length) return [];\n  const logs = await Promise.all(logIds.map((id) => getAuditLog(id)));\n  return logs.filter((l): l is AuditLog => l !== null);\n}\n\n// Helper to add audit log\nexport async function addAuditLog(\n  action: AuditAction,\n  entityType: AuditLog['entityType'],\n  entityId: string,\n  actor: { id: string; name: string; type: AuditLog['actorType'] },\n  options?: {\n    entityName?: string;\n    changes?: AuditLog['changes'];\n    metadata?: AuditLog['metadata'];\n    ipAddress?: string;\n    userAgent?: string;\n  }\n): Promise<void> {\n  const log: AuditLog = {\n    id: generateId(),\n    actorId: actor.id,\n    actorName: actor.name,\n    actorType: actor.type,\n    action,\n    entityType,\n    entityId,\n    entityName: options?.entityName,\n    changes: options?.changes,\n    metadata: options?.metadata,\n    timestamp: new Date().toISOString(),\n    ipAddress: options?.ipAddress,\n    userAgent: options?.userAgent,\n  };\n\n  await createAuditLog(log);\n}\n","// Redis Key Patterns for Partner Portal\n\nexport const keys = {\n  // Partners\n  partner: (id: string) => `partner:${id}`,\n  partnerUsers: (partnerId: string) => `partner:${partnerId}:users`,\n  partnersByTier: (tier: string) => `partners:by-tier:${tier}`,\n  partnersByStatus: (status: string) => `partners:by-status:${status}`,\n  partnersByCountry: (country: string) => `partners:by-country:${country}`,\n  allPartners: () => `partners:all`,\n\n  // Partner Credentials (SovraID)\n  partnerCredential: (id: string) => `credential:${id}`,\n  partnerCredentials: (partnerId: string) => `partner:${partnerId}:credentials`,\n  allCredentials: () => `credentials:all`,\n  credentialsByStatus: (status: string) => `credentials:by-status:${status}`,\n  credentialByEmail: (email: string) => `credential:email:${email.toLowerCase()}`,\n\n  // Users & Sessions\n  user: (id: string) => `user:${id}`,\n  userByEmail: (email: string) => `user:email:${email.toLowerCase()}`,\n  session: (id: string) => `session:${id}`,\n\n  // Deals\n  deal: (id: string) => `deal:${id}`,\n  partnerDeals: (partnerId: string) => `partner:${partnerId}:deals`,\n  dealsByDomain: (domain: string) => `deals:by-domain:${domain.toLowerCase()}`,\n  dealsByStage: (stage: string) => `deals:by-stage:${stage}`,\n  dealsByStatus: (status: string) => `deals:by-status:${status}`,\n  allDeals: () => `deals:all`,\n\n  // Quotes\n  quote: (id: string) => `quote:${id}`,\n  dealQuotes: (dealId: string) => `deal:${dealId}:quotes`,\n  partnerQuotes: (partnerId: string) => `partner:${partnerId}:quotes`,\n\n  // Pricing Configuration\n  pricingConfig: () => `pricing:config`,\n\n  // Training & Certifications\n  trainingModule: (id: string) => `training:module:${id}`,\n  trainingModules: () => `training:modules`,\n  userTrainingProgress: (userId: string) => `user:${userId}:training:progress`,\n  certification: (id: string) => `certification:${id}`,\n  userCertifications: (userId: string) => `user:${userId}:certifications`,\n  partnerCertifications: (partnerId: string) => `partner:${partnerId}:certifications`,\n\n  // Legal - Legacy\n  legalDocument: (id: string) => `legal:document:${id}`,\n  legalDocuments: () => `legal:documents`,\n  legalSignature: (id: string) => `legal:signature:${id}`,\n  userSignatures: (userId: string) => `user:${userId}:signatures`,\n  partnerSignatures: (partnerId: string) => `partner:${partnerId}:signatures`,\n\n  // Legal - Enhanced Documents\n  legalDocumentV2: (id: string) => `legal:v2:document:${id}`,\n  partnerLegalDocuments: (partnerId: string) => `partner:${partnerId}:legal:documents`,\n  allLegalDocumentsV2: () => `legal:v2:all`,\n  legalDocumentsByCategory: (category: string) => `legal:v2:by-category:${category}`,\n  legalDocumentsByStatus: (status: string) => `legal:v2:by-status:${status}`,\n  docusignEnvelope: (envelopeId: string) => `legal:docusign:envelope:${envelopeId}`,\n\n  // Legal - Audit Events\n  documentAuditEvents: (documentId: string) => `legal:v2:document:${documentId}:audit`,\n  documentAuditEvent: (eventId: string) => `legal:v2:audit:${eventId}`,\n\n  // Copilot\n  copilotSession: (id: string) => `copilot:session:${id}`,\n  copilotMessages: (sessionId: string) => `copilot:session:${sessionId}:messages`,\n  copilotMeddic: (sessionId: string) => `copilot:session:${sessionId}:meddic`,\n  dealCopilotSessions: (dealId: string) => `deal:${dealId}:copilot:sessions`,\n\n  // Commissions\n  commission: (id: string) => `commission:${id}`,\n  partnerCommissions: (partnerId: string) => `partner:${partnerId}:commissions`,\n  dealCommission: (dealId: string) => `deal:${dealId}:commission`,\n\n  // Rating\n  ratingEvents: (partnerId: string) => `partner:${partnerId}:rating:events`,\n  ratingCalculation: (partnerId: string) => `partner:${partnerId}:rating:calculation`,\n  partnerLastLogin: (partnerId: string) => `partner:${partnerId}:last-login`,\n\n  // Training Courses (Admin-managed)\n  trainingCourse: (id: string) => `training:course:${id}`,\n  allTrainingCourses: () => `training:courses:all`,\n  publishedTrainingCourses: () => `training:courses:published`,\n  trainingCoursesByCategory: (category: string) => `training:courses:by-category:${category}`,\n  userCourseProgress: (userId: string) => `user:${userId}:courses:progress`,\n\n  // Audit Logs\n  auditLog: (id: string) => `audit:log:${id}`,\n  allAuditLogs: () => `audit:logs:all`,\n  auditLogsByEntity: (entityType: string, entityId: string) => `audit:logs:entity:${entityType}:${entityId}`,\n  auditLogsByAction: (action: string) => `audit:logs:by-action:${action}`,\n  auditLogsByActor: (actorId: string) => `audit:logs:by-actor:${actorId}`,\n};\n\n// TTL values in seconds\nexport const TTL = {\n  session: 24 * 60 * 60, // 24 hours\n  dealExclusivity: 90 * 24 * 60 * 60, // 90 days\n  copilotSession: 7 * 24 * 60 * 60, // 7 days\n};\n"],"names":[],"mappings":"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"}