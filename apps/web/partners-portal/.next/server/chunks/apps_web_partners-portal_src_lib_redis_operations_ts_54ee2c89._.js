module.exports=[31967,81769,e=>{"use strict";var t=e.i(89161);let a={partner:e=>`partner:${e}`,partnerUsers:e=>`partner:${e}:users`,partnersByTier:e=>`partners:by-tier:${e}`,partnersByStatus:e=>`partners:by-status:${e}`,partnersByCountry:e=>`partners:by-country:${e}`,allPartners:()=>"partners:all",partnerCredential:e=>`credential:${e}`,partnerCredentials:e=>`partner:${e}:credentials`,allCredentials:()=>"credentials:all",credentialsByStatus:e=>`credentials:by-status:${e}`,credentialByEmail:e=>`credential:email:${e.toLowerCase()}`,user:e=>`user:${e}`,userByEmail:e=>`user:email:${e.toLowerCase()}`,session:e=>`session:${e}`,deal:e=>`deal:${e}`,partnerDeals:e=>`partner:${e}:deals`,dealsByDomain:e=>`deals:by-domain:${e.toLowerCase()}`,dealsByStage:e=>`deals:by-stage:${e}`,dealsByStatus:e=>`deals:by-status:${e}`,allDeals:()=>"deals:all",quote:e=>`quote:${e}`,dealQuotes:e=>`deal:${e}:quotes`,partnerQuotes:e=>`partner:${e}:quotes`,pricingConfig:()=>"pricing:config",trainingModule:e=>`training:module:${e}`,trainingModules:()=>"training:modules",userTrainingProgress:e=>`user:${e}:training:progress`,certification:e=>`certification:${e}`,userCertifications:e=>`user:${e}:certifications`,partnerCertifications:e=>`partner:${e}:certifications`,legalDocument:e=>`legal:document:${e}`,legalDocuments:()=>"legal:documents",legalSignature:e=>`legal:signature:${e}`,userSignatures:e=>`user:${e}:signatures`,partnerSignatures:e=>`partner:${e}:signatures`,legalDocumentV2:e=>`legal:v2:document:${e}`,partnerLegalDocuments:e=>`partner:${e}:legal:documents`,allLegalDocumentsV2:()=>"legal:v2:all",legalDocumentsByCategory:e=>`legal:v2:by-category:${e}`,legalDocumentsByStatus:e=>`legal:v2:by-status:${e}`,docusignEnvelope:e=>`legal:docusign:envelope:${e}`,documentAuditEvents:e=>`legal:v2:document:${e}:audit`,documentAuditEvent:e=>`legal:v2:audit:${e}`,copilotSession:e=>`copilot:session:${e}`,copilotMessages:e=>`copilot:session:${e}:messages`,copilotMeddic:e=>`copilot:session:${e}:meddic`,dealCopilotSessions:e=>`deal:${e}:copilot:sessions`,commission:e=>`commission:${e}`,partnerCommissions:e=>`partner:${e}:commissions`,dealCommission:e=>`deal:${e}:commission`,ratingEvents:e=>`partner:${e}:rating:events`,ratingCalculation:e=>`partner:${e}:rating:calculation`,partnerLastLogin:e=>`partner:${e}:last-login`,trainingCourse:e=>`training:course:${e}`,allTrainingCourses:()=>"training:courses:all",publishedTrainingCourses:()=>"training:courses:published",trainingCoursesByCategory:e=>`training:courses:by-category:${e}`,userCourseProgress:e=>`user:${e}:courses:progress`,auditLog:e=>`audit:log:${e}`,allAuditLogs:()=>"audit:logs:all",auditLogsByEntity:(e,t)=>`audit:logs:entity:${e}:${t}`,auditLogsByAction:e=>`audit:logs:by-action:${e}`,auditLogsByActor:e=>`audit:logs:by-actor:${e}`},r={session:86400,dealExclusivity:7776e3,copilotSession:604800};function i(e){let t={};for(let[a,r]of Object.entries(e))null==r?t[a]="":"object"==typeof r?t[a]=JSON.stringify(r):t[a]=r;return t}function n(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}async function s(e){let r=await t.redis.hgetall(a.partner(e));return r&&r.id?("string"==typeof r.rating&&(r.rating=parseFloat(r.rating)),"string"==typeof r.totalDeals&&(r.totalDeals=parseInt(r.totalDeals,10)),"string"==typeof r.wonDeals&&(r.wonDeals=parseInt(r.wonDeals,10)),"string"==typeof r.totalRevenue&&(r.totalRevenue=parseFloat(r.totalRevenue)),"string"==typeof r.certifications&&r.certifications&&(r.certifications=JSON.parse(r.certifications)),r):null}async function l(e){let r=t.redis.pipeline(),n={...e,certifications:e.certifications?JSON.stringify(e.certifications):""};r.hset(a.partner(e.id),i(n)),r.zadd(a.partnersByTier(e.tier),{score:e.rating,member:e.id}),r.sadd(a.partnersByStatus(e.status),e.id),e.country&&r.sadd(a.partnersByCountry(e.country),e.id),r.zadd(a.allPartners(),{score:new Date(e.createdAt).getTime(),member:e.id}),await r.exec()}async function o(e=100){let r=await t.redis.zrange(a.allPartners(),0,e-1,{rev:!0});return(r.length||(r=(await t.redis.keys("partner:*")).filter(e=>!e.includes(":")||2===e.split(":").length).filter(e=>!e.includes("users")&&!e.includes("deals")&&!e.includes("legal")).map(e=>e.replace("partner:",""))),r.length)?(await Promise.all(r.map(e=>s(e)))).filter(e=>null!==e):[]}async function d(e){let r=await t.redis.smembers(a.partnersByStatus(e));return r.length?(await Promise.all(r.map(e=>s(e)))).filter(e=>null!==e):[]}async function u(e){let r=await t.redis.zrange(a.partnersByTier(e),0,-1);return r.length?(await Promise.all(r.map(e=>s(e)))).filter(e=>null!==e):[]}async function c(e){let r=await t.redis.smembers(a.partnersByCountry(e));return r.length?(await Promise.all(r.map(e=>s(e)))).filter(e=>null!==e):[]}async function g(e,r){let n=await s(e);if(!n)throw Error("Partner not found");let l=t.redis.pipeline(),o={...r,updatedAt:new Date().toISOString()};r.certifications&&(o.certifications=JSON.stringify(r.certifications)),l.hset(a.partner(e),i(o)),r.tier&&r.tier!==n.tier&&(l.zrem(a.partnersByTier(n.tier),e),l.zadd(a.partnersByTier(r.tier),{score:r.rating??n.rating,member:e})),r.status&&r.status!==n.status&&(l.srem(a.partnersByStatus(n.status),e),l.sadd(a.partnersByStatus(r.status),e)),r.country&&r.country!==n.country&&(n.country&&l.srem(a.partnersByCountry(n.country),e),l.sadd(a.partnersByCountry(r.country),e)),await l.exec()}async function p(e,t,a){await g(e,{status:"suspended",suspendedAt:new Date().toISOString(),suspendedBy:t,suspendedReason:a})}async function m(e){if(!await s(e))throw Error("Partner not found");let r=t.redis.pipeline();r.hset(a.partner(e),i({status:"active",suspendedAt:"",suspendedBy:"",suspendedReason:"",updatedAt:new Date().toISOString()})),r.srem(a.partnersByStatus("suspended"),e),r.sadd(a.partnersByStatus("active"),e),await r.exec()}async function y(e){let r=await s(e);if(!r)throw Error("Partner not found");let i=t.redis.pipeline();for(let n of(i.del(a.partner(e)),i.zrem(a.allPartners(),e),i.zrem(a.partnersByTier(r.tier),e),i.srem(a.partnersByStatus(r.status),e),r.country&&i.srem(a.partnersByCountry(r.country),e),await t.redis.zrange(a.partnerDeals(e),0,-1)))i.del(`deal:${n}`),i.zrem(a.allDeals(),n);for(let r of(i.del(a.partnerDeals(e)),await t.redis.smembers(a.partnerCredentials(e))))i.del(a.partnerCredential(r));for(let r of(i.del(a.partnerCredentials(e)),await t.redis.smembers(a.partnerUsers(e)))){let e=await t.redis.hgetall(`user:${r}`);e?.email&&i.del(`user:email:${e.email}`),i.del(`user:${r}`)}i.del(a.partnerUsers(e)),i.del(`partner:${e}:legal:documents`),i.del(`partner:${e}:signatures`),i.del(`partner:${e}:certifications`),i.del(`partner:${e}:commissions`),await i.exec()}async function f(e){let[t,a]=await Promise.all([$(e),ef(e)]),r=t.filter(e=>"closed_won"===e.status).length,i=t.filter(e=>"closed_lost"===e.status).length,n=t.filter(e=>!["closed_won","closed_lost","rejected"].includes(e.status)).length;return{totalDeals:t.length,wonDeals:r,lostDeals:i,pendingDeals:n,totalRevenue:0,credentialsCount:a.length,activeCredentials:a.filter(e=>"active"===e.status).length}}async function w(e){let r=await t.redis.hgetall(a.user(e));return r&&r.id?r:null}async function h(e){let r=await t.redis.get(a.userByEmail(e));return r?w(r):null}async function S(e){let r=t.redis.pipeline();r.hset(a.user(e.id),i(e)),r.set(a.userByEmail(e.email),e.id),r.sadd(a.partnerUsers(e.partnerId),e.id),await r.exec()}async function C(e,r){await t.redis.hset(a.user(e),i({...r,updatedAt:new Date().toISOString()}))}async function D(e){let r=await t.redis.smembers(a.partnerUsers(e));return r.length?(await Promise.all(r.map(e=>w(e)))).filter(e=>null!==e):[]}async function P(e,s){let l={id:n(),userId:e,partnerId:s,expiresAt:new Date(Date.now()+1e3*r.session).toISOString(),createdAt:new Date().toISOString()};return await t.redis.hset(a.session(l.id),i(l)),await t.redis.expire(a.session(l.id),r.session),l}async function b(e){let r=await t.redis.hgetall(a.session(e));return r&&r.id?new Date(r.expiresAt)<new Date?(await v(e),null):r:null}async function v(e){await t.redis.del(a.session(e))}async function B(e){let r=await t.redis.hgetall(a.deal(e));return r&&r.id?("string"==typeof r.population&&(r.population=parseInt(r.population,10)),"string"==typeof r.partnerGeneratedLead&&(r.partnerGeneratedLead="true"===r.partnerGeneratedLead),r):null}async function $(e,r=50){let i=await t.redis.zrange(a.partnerDeals(e),0,r-1,{rev:!0});return i.length?(await Promise.all(i.map(e=>B(e)))).filter(e=>null!==e):[]}async function O(e){let r=t.redis.pipeline();r.hset(a.deal(e.id),i(e)),r.zadd(a.partnerDeals(e.partnerId),{score:new Date(e.createdAt).getTime(),member:e.id}),r.zadd(a.allDeals(),{score:new Date(e.createdAt).getTime(),member:e.id}),r.sadd(a.dealsByStatus(e.status),e.id),await r.exec()}async function T(e,r){let n=await B(e);if(!n)throw Error("Deal not found");let s=t.redis.pipeline(),l={...r,updatedAt:new Date().toISOString()};s.hset(a.deal(e),i(l)),r.status&&r.status!==n.status&&(s.srem(a.dealsByStatus(n.status),e),s.sadd(a.dealsByStatus(r.status),e)),await s.exec()}async function A(e){let r=await t.redis.smembers(a.dealsByStatus(e));return r.length?(await Promise.all(r.map(e=>B(e)))).filter(e=>null!==e):[]}async function I(e=100){let r=await t.redis.zrange(a.allDeals(),0,e-1,{rev:!0});return r.length?(await Promise.all(r.map(e=>B(e)))).filter(e=>null!==e):[]}async function N(e,r){let i=await t.redis.smembers(a.dealsByDomain(e.toLowerCase()));return r?i.filter(e=>e!==r):i}async function J(e){let r=await t.redis.hgetall(a.trainingModule(e));return r&&r.id?("string"==typeof r.title&&(r.title=JSON.parse(r.title)),"string"==typeof r.description&&(r.description=JSON.parse(r.description)),"string"==typeof r.content&&(r.content=JSON.parse(r.content)),"string"==typeof r.quiz&&(r.quiz=JSON.parse(r.quiz)),r):null}async function L(){let e=await t.redis.smembers(a.trainingModules());return e.length?(await Promise.all(e.map(e=>J(e)))).filter(e=>null!==e).sort((e,t)=>e.order-t.order):[]}async function M(e){let r=await t.redis.hgetall(a.userTrainingProgress(e));if(!r)return{};let i={};for(let[e,t]of Object.entries(r))i[e]="string"==typeof t?JSON.parse(t):t;return i}async function z(e,r){await t.redis.hset(a.userTrainingProgress(e),{[r.moduleId]:JSON.stringify(r)})}async function x(e){let r=await t.redis.hgetall(a.certification(e));return r&&r.id?r:null}async function E(e){let r=await t.redis.smembers(a.userCertifications(e));return r.length?(await Promise.all(r.map(e=>x(e)))).filter(e=>null!==e):[]}async function q(e){let r=t.redis.pipeline();r.hset(a.certification(e.id),i(e)),r.sadd(a.userCertifications(e.userId),e.id),r.sadd(a.partnerCertifications(e.partnerId),e.id),await r.exec()}async function F(e){return(await E(e)).some(e=>"active"===e.status&&new Date(e.expiresAt)>new Date)}async function R(e){let r=await t.redis.hgetall(a.legalDocument(e));return r&&r.id?("string"==typeof r.title&&(r.title=JSON.parse(r.title)),"string"==typeof r.content&&(r.content=JSON.parse(r.content)),r):null}async function U(){let e=await t.redis.smembers(a.legalDocuments());return e.length?(await Promise.all(e.map(e=>R(e)))).filter(e=>null!==e):[]}async function V(e){let r=t.redis.pipeline();r.hset(a.legalSignature(e.id),i(e)),r.sadd(a.userSignatures(e.userId),e.id),r.sadd(a.partnerSignatures(e.partnerId),e.id),await r.exec()}async function Q(e){let r=await t.redis.smembers(a.userSignatures(e));return r.length?(await Promise.all(r.map(e=>t.redis.hgetall(a.legalSignature(e))))).filter(e=>null!==e&&!!e.id):[]}async function k(e){let[t,a]=await Promise.all([U(),Q(e)]),r=t.filter(e=>e.requiredForDeals),i=new Set(a.map(e=>e.documentId));return r.every(e=>i.has(e.id))}async function j(e,s){let l={id:n(),dealId:e,userId:s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},o=t.redis.pipeline();return o.hset(a.copilotSession(l.id),i(l)),o.expire(a.copilotSession(l.id),r.copilotSession),o.sadd(a.dealCopilotSessions(e),l.id),await o.exec(),l}async function G(e){let r=await t.redis.hgetall(a.copilotSession(e));return r&&r.id?r:null}async function _(e,r){await t.redis.rpush(a.copilotMessages(e),JSON.stringify(r))}async function H(e){return(await t.redis.lrange(a.copilotMessages(e),0,-1)).map(e=>"string"==typeof e?JSON.parse(e):e)}async function K(e,r){await t.redis.hset(a.copilotMeddic(e),i(r))}async function W(e){let r=await t.redis.hgetall(a.commission(e));return r&&r.id?r:null}async function X(e){let r=await t.redis.smembers(a.partnerCommissions(e));return r.length?(await Promise.all(r.map(e=>W(e)))).filter(e=>null!==e):[]}async function Y(e){let r=await t.redis.hgetall(a.quote(e));return r&&r.id?("string"==typeof r.products&&(r.products=JSON.parse(r.products)),"string"==typeof r.services&&(r.services=JSON.parse(r.services)),"string"==typeof r.discounts&&(r.discounts=JSON.parse(r.discounts)),"string"==typeof r.version&&(r.version=parseInt(r.version,10)),"string"==typeof r.subtotal&&(r.subtotal=parseFloat(r.subtotal)),"string"==typeof r.totalDiscount&&(r.totalDiscount=parseFloat(r.totalDiscount)),"string"==typeof r.total&&(r.total=parseFloat(r.total)),r):null}async function Z(e){let r=await t.redis.zrange(a.dealQuotes(e),0,-1,{rev:!0});return r.length?(await Promise.all(r.map(e=>Y(e)))).filter(e=>null!==e):[]}async function ee(e,r=50){let i=await t.redis.zrange(a.partnerQuotes(e),0,r-1,{rev:!0});return i.length?(await Promise.all(i.map(e=>Y(e)))).filter(e=>null!==e):[]}async function et(e){let r=t.redis.pipeline(),n={...e,products:JSON.stringify(e.products),services:JSON.stringify(e.services),discounts:JSON.stringify(e.discounts)};r.hset(a.quote(e.id),i(n)),r.zadd(a.dealQuotes(e.dealId),{score:e.version,member:e.id}),r.zadd(a.partnerQuotes(e.partnerId),{score:new Date(e.createdAt).getTime(),member:e.id}),await r.exec()}async function ea(e){let t=await Z(e);return t.length?Math.max(...t.map(e=>e.version))+1:1}e.s(["TTL",0,r,"keys",0,a],81769);let er={sovraGov:{tiers:[{maxPopulation:1e5,pricePerInhabitant:.5},{maxPopulation:25e4,pricePerInhabitant:.4},{maxPopulation:5e5,pricePerInhabitant:.32},{maxPopulation:1e6,pricePerInhabitant:.26},{maxPopulation:25e5,pricePerInhabitant:.2},{maxPopulation:5e6,pricePerInhabitant:.16},{maxPopulation:1e7,pricePerInhabitant:.13}]},sovraId:{essentials:{monthlyLimit:1e4,monthlyPrice:1e3},professional:{monthlyLimit:3e4,monthlyPrice:2e3},enterprise:{monthlyLimit:5e4,monthlyPrice:3e3}},services:{walletImplementation:5e3,integrationHourlyRate:150},discounts:{bronze:{base:5,leadBonus:0},silver:{base:20,leadBonus:10},gold:{base:25,leadBonus:15},platinum:{base:30,leadBonus:20}}};async function ei(){let e=await t.redis.get(a.pricingConfig());return e?"string"==typeof e?JSON.parse(e):e:(await en(er),er)}async function en(e){await t.redis.set(a.pricingConfig(),JSON.stringify(e))}async function es(e){let r=await t.redis.hgetall(a.legalDocumentV2(e));return r&&r.id?("string"==typeof r.docusignMetadata&&r.docusignMetadata?r.docusignMetadata=JSON.parse(r.docusignMetadata):r.docusignMetadata=void 0,"string"==typeof r.uploadMetadata&&r.uploadMetadata?r.uploadMetadata=JSON.parse(r.uploadMetadata):r.uploadMetadata=void 0,"string"==typeof r.version&&(r.version=parseInt(r.version,10)),r):null}async function el(e,r=100){console.log("[Redis] Fetching documents for partner:",e,"key:",a.partnerLegalDocuments(e));let i=await t.redis.zrange(a.partnerLegalDocuments(e),0,r-1,{rev:!0});return(console.log("[Redis] Found document IDs:",i.length,i),i.length)?(await Promise.all(i.map(e=>es(e)))).filter(e=>null!==e):[]}async function eo(e=100){let r=await t.redis.zrange(a.allLegalDocumentsV2(),0,e-1,{rev:!0});return r.length?(await Promise.all(r.map(e=>es(e)))).filter(e=>null!==e):[]}async function ed(e){console.log("[Redis] Creating legal document:",e.id,"for partner:",e.partnerId);let r=t.redis.pipeline(),n={...e,docusignMetadata:e.docusignMetadata?JSON.stringify(e.docusignMetadata):"",uploadMetadata:e.uploadMetadata?JSON.stringify(e.uploadMetadata):""};r.hset(a.legalDocumentV2(e.id),i(n)),r.zadd(a.partnerLegalDocuments(e.partnerId),{score:new Date(e.createdAt).getTime(),member:e.id}),r.zadd(a.allLegalDocumentsV2(),{score:new Date(e.createdAt).getTime(),member:e.id}),r.sadd(a.legalDocumentsByCategory(e.category),e.id),r.sadd(a.legalDocumentsByStatus(e.status),e.id),"docusign"===e.type&&e.docusignMetadata?.envelopeId&&r.set(a.docusignEnvelope(e.docusignMetadata.envelopeId),e.id),await r.exec()}async function eu(e,r){let n=await es(e);if(!n)throw Error("Document not found");let s=t.redis.pipeline(),l={...r,updatedAt:new Date().toISOString()};r.docusignMetadata&&(l.docusignMetadata=JSON.stringify(r.docusignMetadata)),r.uploadMetadata&&(l.uploadMetadata=JSON.stringify(r.uploadMetadata)),s.hset(a.legalDocumentV2(e),i(l)),r.status&&r.status!==n.status&&(s.srem(a.legalDocumentsByStatus(n.status),e),s.sadd(a.legalDocumentsByStatus(r.status),e)),r.category&&r.category!==n.category&&(s.srem(a.legalDocumentsByCategory(n.category),e),s.sadd(a.legalDocumentsByCategory(r.category),e)),await s.exec()}async function ec(e){let r=await t.redis.get(a.docusignEnvelope(e));return r?es(r):null}async function eg(e){let r=t.redis.pipeline();r.hset(a.documentAuditEvent(e.id),i(e)),r.zadd(a.documentAuditEvents(e.documentId),{score:new Date(e.timestamp).getTime(),member:e.id}),await r.exec()}async function ep(e,r=50){let i=await t.redis.zrange(a.documentAuditEvents(e),0,r-1,{rev:!0});return i.length?(await Promise.all(i.map(async e=>{let r=await t.redis.hgetall(a.documentAuditEvent(e));return r&&r.id?("string"==typeof r.details&&(r.details=JSON.parse(r.details)),r):null}))).filter(e=>null!==e):[]}async function em(e,t,a,r,i){let s={id:n(),documentId:e,action:t,actorType:a.type,actorId:a.id,actorName:a.name,details:r,ipAddress:i?.ipAddress,userAgent:i?.userAgent,timestamp:new Date().toISOString()};await eg(s)}async function ey(e){let r=await t.redis.hgetall(a.partnerCredential(e));return r&&r.id?r:null}async function ef(e,r=100){let i=await t.redis.zrange(a.partnerCredentials(e),0,r-1,{rev:!0});return i.length?(await Promise.all(i.map(e=>ey(e)))).filter(e=>null!==e):[]}async function ew(e){let r=await t.redis.get(a.credentialByEmail(e));return r?ey(r):null}async function eh(e){let r=t.redis.pipeline();r.hset(a.partnerCredential(e.id),i(e)),r.zadd(a.partnerCredentials(e.partnerId),{score:new Date(e.createdAt).getTime(),member:e.id}),r.zadd(a.allCredentials(),{score:new Date(e.createdAt).getTime(),member:e.id}),r.sadd(a.credentialsByStatus(e.status),e.id),r.set(a.credentialByEmail(e.holderEmail),e.id),await r.exec()}async function eS(e,r){let n=await ey(e);if(!n)throw Error("Credential not found");let s=t.redis.pipeline(),l={...r,updatedAt:new Date().toISOString()};s.hset(a.partnerCredential(e),i(l)),r.status&&r.status!==n.status&&(s.srem(a.credentialsByStatus(n.status),e),s.sadd(a.credentialsByStatus(r.status),e)),await s.exec()}async function eC(e,t,a){await eS(e,{status:"revoked",revokedAt:new Date().toISOString(),revokedBy:t,revokedReason:a})}async function eD(e,t,a){for(let r of(await ef(e)).filter(e=>["active","claimed","issued"].includes(e.status)))await eC(r.id,t,a)}async function eP(e){let r=await t.redis.hgetall(a.trainingCourse(e));return r&&r.id?("string"==typeof r.title&&(r.title=JSON.parse(r.title)),"string"==typeof r.description&&(r.description=JSON.parse(r.description)),"string"==typeof r.modules&&(r.modules=JSON.parse(r.modules)),"string"==typeof r.requiredForTiers&&r.requiredForTiers&&(r.requiredForTiers=JSON.parse(r.requiredForTiers)),"string"==typeof r.isPublished&&(r.isPublished="true"===r.isPublished),"string"==typeof r.isRequired&&(r.isRequired="true"===r.isRequired),"string"==typeof r.certificateEnabled&&(r.certificateEnabled="true"===r.certificateEnabled),"string"==typeof r.duration&&(r.duration=parseInt(r.duration,10)),"string"==typeof r.passingScore&&(r.passingScore=parseInt(r.passingScore,10)),"string"==typeof r.order&&(r.order=parseInt(r.order,10)),r):null}async function eb(){let e=await t.redis.zrange(a.allTrainingCourses(),0,-1,{rev:!0});return e.length?(await Promise.all(e.map(e=>eP(e)))).filter(e=>null!==e).sort((e,t)=>e.order-t.order):[]}async function ev(){let e=await t.redis.smembers(a.publishedTrainingCourses());return e.length?(await Promise.all(e.map(e=>eP(e)))).filter(e=>null!==e).sort((e,t)=>e.order-t.order):[]}async function eB(e){let r=await t.redis.smembers(a.trainingCoursesByCategory(e));return r.length?(await Promise.all(r.map(e=>eP(e)))).filter(e=>null!==e).sort((e,t)=>e.order-t.order):[]}async function e$(e){let r=t.redis.pipeline(),n={...e,title:JSON.stringify(e.title),description:JSON.stringify(e.description),modules:JSON.stringify(e.modules),requiredForTiers:e.requiredForTiers?JSON.stringify(e.requiredForTiers):""};r.hset(a.trainingCourse(e.id),i(n)),r.zadd(a.allTrainingCourses(),{score:e.order,member:e.id}),r.sadd(a.trainingCoursesByCategory(e.category),e.id),e.isPublished&&r.sadd(a.publishedTrainingCourses(),e.id),await r.exec()}async function eO(e,r){let n=await eP(e);if(!n)throw Error("Course not found");let s=t.redis.pipeline(),l={...r,updatedAt:new Date().toISOString()};r.title&&(l.title=JSON.stringify(r.title)),r.description&&(l.description=JSON.stringify(r.description)),r.modules&&(l.modules=JSON.stringify(r.modules)),r.requiredForTiers&&(l.requiredForTiers=JSON.stringify(r.requiredForTiers)),s.hset(a.trainingCourse(e),i(l)),r.category&&r.category!==n.category&&(s.srem(a.trainingCoursesByCategory(n.category),e),s.sadd(a.trainingCoursesByCategory(r.category),e)),void 0!==r.isPublished&&r.isPublished!==n.isPublished&&(r.isPublished?s.sadd(a.publishedTrainingCourses(),e):s.srem(a.publishedTrainingCourses(),e)),void 0!==r.order&&r.order!==n.order&&s.zadd(a.allTrainingCourses(),{score:r.order,member:e}),await s.exec()}async function eT(e){let r=await eP(e);if(!r)throw Error("Course not found");let i=t.redis.pipeline();i.del(a.trainingCourse(e)),i.zrem(a.allTrainingCourses(),e),i.srem(a.trainingCoursesByCategory(r.category),e),r.isPublished&&i.srem(a.publishedTrainingCourses(),e),await i.exec()}async function eA(e){await eO(e,{isPublished:!0})}async function eI(e){await eO(e,{isPublished:!1})}async function eN(e){let r=t.redis.pipeline(),n={...e,changes:e.changes?JSON.stringify(e.changes):"",metadata:e.metadata?JSON.stringify(e.metadata):""};r.hset(a.auditLog(e.id),i(n)),r.zadd(a.allAuditLogs(),{score:new Date(e.timestamp).getTime(),member:e.id}),r.zadd(a.auditLogsByEntity(e.entityType,e.entityId),{score:new Date(e.timestamp).getTime(),member:e.id}),r.sadd(a.auditLogsByAction(e.action),e.id),e.actorId&&r.zadd(a.auditLogsByActor(e.actorId),{score:new Date(e.timestamp).getTime(),member:e.id}),await r.exec()}async function eJ(e){let r=await t.redis.hgetall(a.auditLog(e));return r&&r.id?("string"==typeof r.changes&&r.changes&&(r.changes=JSON.parse(r.changes)),"string"==typeof r.metadata&&r.metadata&&(r.metadata=JSON.parse(r.metadata)),r):null}async function eL(e=100,r=0){let i=await t.redis.zrange(a.allAuditLogs(),r,r+e-1,{rev:!0});return i.length?(await Promise.all(i.map(e=>eJ(e)))).filter(e=>null!==e):[]}async function eM(e,t,a,r,i){let s={id:n(),actorId:r.id,actorName:r.name,actorType:r.type,action:e,entityType:t,entityId:a,entityName:i?.entityName,changes:i?.changes,metadata:i?.metadata,timestamp:new Date().toISOString(),ipAddress:i?.ipAddress,userAgent:i?.userAgent};await eN(s)}e.s(["addAuditLog",()=>eM,"addCopilotMessage",()=>_,"addDocumentAuditLog",()=>em,"checkDomainConflict",()=>N,"createCertification",()=>q,"createCopilotSession",()=>j,"createDeal",()=>O,"createLegalDocumentV2",()=>ed,"createPartner",()=>l,"createPartnerCredential",()=>eh,"createQuote",()=>et,"createSession",()=>P,"createTrainingCourse",()=>e$,"createUser",()=>S,"deletePartner",()=>y,"deleteSession",()=>v,"deleteTrainingCourse",()=>eT,"generateId",()=>n,"getAllAuditLogs",()=>eL,"getAllDeals",()=>I,"getAllLegalDocuments",()=>U,"getAllLegalDocumentsV2",()=>eo,"getAllPartners",()=>o,"getAllTrainingCourses",()=>eb,"getAllTrainingModules",()=>L,"getCopilotMessages",()=>H,"getCopilotSession",()=>G,"getCredentialByEmail",()=>ew,"getDeal",()=>B,"getDealsByStatus",()=>A,"getDocumentAuditEvents",()=>ep,"getLegalDocument",()=>R,"getLegalDocumentByEnvelopeId",()=>ec,"getLegalDocumentV2",()=>es,"getNextQuoteVersion",()=>ea,"getPartner",()=>s,"getPartnerCommissions",()=>X,"getPartnerCredential",()=>ey,"getPartnerCredentials",()=>ef,"getPartnerDeals",()=>$,"getPartnerLegalDocuments",()=>el,"getPartnerQuotes",()=>ee,"getPartnerStats",()=>f,"getPartnerUsers",()=>D,"getPartnersByCountry",()=>c,"getPartnersByStatus",()=>d,"getPartnersByTier",()=>u,"getPricingConfig",()=>ei,"getPublishedTrainingCourses",()=>ev,"getQuote",()=>Y,"getSession",()=>b,"getTrainingCourse",()=>eP,"getTrainingCoursesByCategory",()=>eB,"getTrainingModule",()=>J,"getUser",()=>w,"getUserByEmail",()=>h,"getUserCertifications",()=>E,"getUserSignatures",()=>Q,"getUserTrainingProgress",()=>M,"hasSignedRequiredDocs",()=>k,"hasValidCertification",()=>F,"publishTrainingCourse",()=>eA,"reactivatePartner",()=>m,"revokeAllPartnerCredentials",()=>eD,"revokePartnerCredential",()=>eC,"savePricingConfig",()=>en,"signLegalDocument",()=>V,"suspendPartner",()=>p,"unpublishTrainingCourse",()=>eI,"updateCopilotMeddic",()=>K,"updateDeal",()=>T,"updateLegalDocumentV2",()=>eu,"updatePartner",()=>g,"updatePartnerCredential",()=>eS,"updateTrainingCourse",()=>eO,"updateTrainingProgress",()=>z,"updateUser",()=>C],31967)}];

//# sourceMappingURL=apps_web_partners-portal_src_lib_redis_operations_ts_54ee2c89._.js.map