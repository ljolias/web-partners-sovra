module.exports=[67242,a=>{"use strict";var b=a.i(34076),c=a.i(88972),d=a.i(91757),e=a.i(34887),f=a.i(49902),g=a.i(63508),h=a.i(38617),i=a.i(78551),j=a.i(10680),k=a.i(26464),l=a.i(46143);a.i(96149);var m=a.i(68956),n=a.i(6373),o=a.i(45968),p=a.i(41165),q=a.i(37474),r=a.i(29432),s=a.i(21989),t=a.i(76469),u=a.i(89859);let v=[{value:"financial",label:"Financiero",description:"Reportes de comisiones, facturas, etc."},{value:"policy",label:"Politica",description:"Manuales, guias de uso, politicas"},{value:"compliance",label:"Compliance",description:"Documentos de cumplimiento"},{value:"correspondence",label:"Correspondencia",description:"Cartas y comunicaciones formales"},{value:"certification",label:"Certificacion",description:"Certificados y acreditaciones"}],w=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/png","image/jpeg"];function x({isOpen:a,onClose:d,partner:e,onSuccess:g}){let[h,i]=(0,c.useState)(""),[j,l]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(null),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(!1),F=(0,c.useRef)(null),G=()=>{i(""),l(""),o(""),q(null),y(""),C("")},H=()=>{G(),d()},I=a=>{if(!a)return;let b=a.size>0xa00000?"El archivo excede el tamano maximo de 10MB":w.includes(a.type)?null:"Tipo de archivo no permitido. Usa PDF, DOC, DOCX, XLS, XLSX, PNG o JPG";b?C(b):(q(a),C(""),h||i(a.name.replace(/\.[^/.]+$/,"")))},J=async a=>{if(a.preventDefault(),!p||!n||!h)return void C("Por favor completa todos los campos requeridos");A(!0),C("");try{let a=new FormData;a.append("file",p),a.append("title",h),a.append("description",j),a.append("category",n),a.append("partnerId",e.id),x&&a.append("expirationDate",x);let b=await fetch("/api/sovra/documents",{method:"POST",body:a});if(!b.ok){let a=await b.json();throw Error(a.error||"Error al subir el documento")}G(),g()}catch(a){C(a instanceof Error?a.message:"Error al subir el documento")}finally{A(!1)}};return a?(0,b.jsx)(u.AnimatePresence,{children:(0,b.jsx)(t.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:H,children:(0,b.jsxs)(t.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[var(--color-surface)] rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-hidden border border-[var(--color-border)]",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--color-border)]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"Compartir Documento"}),(0,b.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:["con ",e.companyName]})]}),(0,b.jsx)("button",{onClick:H,className:"p-2 rounded-lg text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-hover)] transition-colors",children:(0,b.jsx)(r.X,{className:"h-5 w-5"})})]}),(0,b.jsxs)("form",{onSubmit:J,className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-140px)]",children:[B&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 text-red-500 rounded-lg text-sm",children:[(0,b.jsx)(s.AlertCircle,{className:"h-4 w-4 flex-shrink-0"}),B]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Categoria *"}),(0,b.jsxs)("select",{value:n,onChange:a=>o(a.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,b.jsx)("option",{value:"",children:"Selecciona una categoria"}),v.map(a=>(0,b.jsxs)("option",{value:a.value,children:[a.label," - ",a.description]},a.value))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Titulo del documento *"}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>i(a.target.value),required:!0,placeholder:"Ej: Reporte de Comisiones Q4 2025",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-[var(--color-text-muted)]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Descripcion (opcional)"}),(0,b.jsx)("textarea",{value:j,onChange:a=>l(a.target.value),rows:2,placeholder:"Descripcion breve del documento...",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] resize-none placeholder:text-[var(--color-text-muted)]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Fecha de vencimiento (opcional)"}),(0,b.jsx)("input",{type:"date",value:x,onChange:a=>y(a.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Archivo *"}),(0,b.jsxs)("div",{onDragOver:a=>{a.preventDefault(),E(!0)},onDragLeave:()=>E(!1),onDrop:a=>{a.preventDefault(),E(!1),I(a.dataTransfer.files[0])},onClick:()=>F.current?.click(),className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${D?"border-[var(--color-primary)] bg-[var(--color-primary)]/10":p?"border-green-500 bg-green-500/10":"border-[var(--color-border)] hover:border-[var(--color-border-hover)]"}`,children:[(0,b.jsx)("input",{ref:F,type:"file",onChange:a=>I(a.target.files?.[0]||null),accept:".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg",className:"hidden"}),p?(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)(k.FileText,{className:"h-6 w-6 text-green-500"}),(0,b.jsx)("span",{className:"text-sm text-green-500 font-medium",children:p.name}),(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),q(null)},className:"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]",children:(0,b.jsx)(r.X,{className:"h-4 w-4"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Upload,{className:"mx-auto h-8 w-8 text-[var(--color-text-muted)]"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-[var(--color-text-secondary)]",children:"Arrastra un archivo o haz clic para seleccionar"}),(0,b.jsx)("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"PDF, DOC, DOCX, XLS, XLSX, PNG, JPG (max 10MB)"})]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-[var(--color-border)]",children:[(0,b.jsx)(m.Button,{variant:"outline",onClick:H,disabled:z,children:"Cancelar"}),(0,b.jsx)(m.Button,{onClick:J,disabled:z||!p||!n||!h,children:z?"Subiendo...":"Compartir Documento"})]})]})})}):null}var y=a.i(92032);let z=[{value:"contract",label:"Contrato",description:"Acuerdos principales, NDA, etc."},{value:"amendment",label:"Addendum",description:"Modificaciones a contratos existentes"}];function A({isOpen:a,onClose:d,partner:g,onSuccess:h}){let[i,j]=(0,c.useState)(""),[l,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("contract"),[q,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(g.contactName||g.name||""),[E,F]=(0,c.useState)(g.contactEmail||g.email||""),[G,H]=(0,c.useState)("Legal Sovra"),[I,J]=(0,c.useState)("legal@sovra.io"),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(!1),Q=(0,c.useRef)(null),R=()=>{j(""),n(""),p("contract"),v(null),x(""),B(""),D(g.contactName||g.name||""),F(g.contactEmail||g.email||""),H("Legal Sovra"),J("legal@sovra.io"),N("")},S=()=>{R(),d()},T=a=>{if(!a)return;let b=a.size>0xa00000?"El archivo excede el tamano maximo de 10MB":"application/pdf"!==a.type?"Solo se permiten archivos PDF para contratos DocuSign":null;b?N(b):(v(a),N(""),i||j(a.name.replace(/\.[^/.]+$/,"")))},U=async a=>{if(a.preventDefault(),!q||!o||!i||!E||!I)return void N("Por favor completa todos los campos requeridos");let b=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!b.test(E)||!b.test(I))return void N("Por favor ingresa emails validos");L(!0),N("");try{let a=new FormData;a.append("file",q),a.append("title",i),a.append("description",l),a.append("category",o),a.append("partnerId",g.id),w&&a.append("effectiveDate",w),A&&a.append("expirationDate",A),a.append("partnerSignerName",C),a.append("partnerSignerEmail",E),a.append("sovraSignerName",G),a.append("sovraSignerEmail",I);let b=await fetch("/api/sovra/documents/send-contract",{method:"POST",body:a}),c=await b.json();if(!b.ok)throw Error(c.error||"Error al enviar el contrato");console.log("[SendContractModal] Document created:",c.document?.id,"for partner:",g.id),alert(`Documento creado exitosamente!

ID: ${c.document?.id}
Partner: ${g.companyName} (${g.id})

Nota: DocuSign esta en modo demo, los emails no se enviaran.`),R(),h()}catch(a){N(a instanceof Error?a.message:"Error al enviar el contrato")}finally{L(!1)}};return a?(0,b.jsx)(u.AnimatePresence,{children:(0,b.jsx)(t.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:S,children:(0,b.jsxs)(t.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[var(--color-surface)] rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden border border-[var(--color-border)]",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--color-border)]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"Enviar Contrato DocuSign"}),(0,b.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:["a ",g.companyName]})]}),(0,b.jsx)("button",{onClick:S,className:"p-2 rounded-lg text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-hover)] transition-colors",children:(0,b.jsx)(r.X,{className:"h-5 w-5"})})]}),(0,b.jsxs)("form",{onSubmit:U,className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-140px)]",children:[M&&(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 text-red-500 rounded-lg text-sm",children:[(0,b.jsx)(s.AlertCircle,{className:"h-4 w-4 flex-shrink-0"}),M]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Tipo de contrato *"}),(0,b.jsx)("select",{value:o,onChange:a=>p(a.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:z.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Titulo del contrato *"}),(0,b.jsx)("input",{type:"text",value:i,onChange:a=>j(a.target.value),required:!0,placeholder:"Ej: Acuerdo de Partner 2026",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-[var(--color-text-muted)]"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Descripcion (opcional)"}),(0,b.jsx)("textarea",{value:l,onChange:a=>n(a.target.value),rows:2,placeholder:"Descripcion breve del contrato...",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] resize-none placeholder:text-[var(--color-text-muted)]"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Fecha de vigencia"}),(0,b.jsx)("input",{type:"date",value:w,onChange:a=>x(a.target.value),className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Fecha de vencimiento"}),(0,b.jsx)("input",{type:"date",value:A,onChange:a=>B(a.target.value),min:w||new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]})]}),(0,b.jsxs)("div",{className:"border border-[var(--color-border)] rounded-lg p-4 space-y-4",children:[(0,b.jsxs)("h3",{className:"font-medium text-[var(--color-text-primary)] flex items-center gap-2",children:[(0,b.jsx)(y.User,{className:"h-4 w-4"}),"Firmantes"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Nombre del Partner *"}),(0,b.jsx)("input",{type:"text",value:C,onChange:a=>D(a.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Email del Partner *"}),(0,b.jsx)("input",{type:"email",value:E,onChange:a=>F(a.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Nombre de Sovra *"}),(0,b.jsx)("input",{type:"text",value:G,onChange:a=>H(a.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Email de Sovra *"}),(0,b.jsx)("input",{type:"email",value:I,onChange:a=>J(a.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Documento PDF *"}),(0,b.jsxs)("div",{onDragOver:a=>{a.preventDefault(),P(!0)},onDragLeave:()=>P(!1),onDrop:a=>{a.preventDefault(),P(!1),T(a.dataTransfer.files[0])},onClick:()=>Q.current?.click(),className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${O?"border-[var(--color-primary)] bg-[var(--color-primary)]/10":q?"border-green-500 bg-green-500/10":"border-[var(--color-border)] hover:border-[var(--color-border-hover)]"}`,children:[(0,b.jsx)("input",{ref:Q,type:"file",onChange:a=>T(a.target.files?.[0]||null),accept:".pdf",className:"hidden"}),q?(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)(k.FileText,{className:"h-6 w-6 text-green-500"}),(0,b.jsx)("span",{className:"text-sm text-green-500 font-medium",children:q.name}),(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),v(null)},className:"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]",children:(0,b.jsx)(r.X,{className:"h-4 w-4"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Upload,{className:"mx-auto h-8 w-8 text-[var(--color-text-muted)]"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-[var(--color-text-secondary)]",children:"Arrastra un archivo PDF o haz clic para seleccionar"}),(0,b.jsx)("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"Solo archivos PDF (max 10MB)"})]})]})]}),(0,b.jsx)("div",{className:"bg-[var(--color-primary)]/10 rounded-lg p-3 text-sm text-[var(--color-primary)]",children:(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Nota:"})," El contrato sera enviado a ambos firmantes via DocuSign. Recibiran un email con el enlace para firmar."]})}),(0,b.jsx)("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-sm text-amber-600 dark:text-amber-400",children:(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Modo Demo:"})," DocuSign no esta configurado. Los documentos se crearan pero los emails de firma no se enviaran. Para activar DocuSign, configura las variables de entorno necesarias."]})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-[var(--color-border)]",children:[(0,b.jsx)(m.Button,{variant:"outline",onClick:S,disabled:K,children:"Cancelar"}),(0,b.jsxs)(m.Button,{onClick:U,disabled:K||!q||!i,children:[(0,b.jsx)(e.Send,{className:"h-4 w-4 mr-2"}),K?"Enviando...":"Enviar Contrato"]})]})]})})}):null}var B=a.i(95201),C=a.i(76197),D=a.i(32777);let E={draft:{color:"text-[var(--color-text-secondary)]",label:"Borrador"},pending_signature:{color:"text-amber-500",label:"Pendiente Firma"},partially_signed:{color:"text-[var(--color-primary)]",label:"Parcialmente Firmado"},active:{color:"text-green-500",label:"Activo"},expired:{color:"text-red-500",label:"Expirado"},superseded:{color:"text-[var(--color-text-muted)]",label:"Reemplazado"},archived:{color:"text-[var(--color-text-muted)]",label:"Archivado"}},F={contract:"Contrato",amendment:"Addendum",compliance:"Compliance",financial:"Financiero",certification:"Certificacion",policy:"Politica",correspondence:"Correspondencia"};function G({document:a,isOpen:d,onClose:e,onRefresh:f}){let[g,l]=(0,c.useState)([]),[o,p]=(0,c.useState)(!1);(0,c.useEffect)(()=>{d&&a.id&&s()},[d,a.id]);let s=async()=>{p(!0);try{let b=await fetch(`/api/sovra/documents/${a.id}`);if(b.ok){let a=await b.json();l(a.auditEvents||[])}}catch(a){console.error("Failed to fetch audit events:",a)}finally{p(!1)}},v=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),x=async b=>{try{(await fetch(`/api/sovra/documents/${a.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b?"verified":"rejected",notes:b?"Documento verificado por admin":"Documento rechazado por admin"})})).ok&&(f(),e())}catch(a){console.error("Failed to verify document:",a)}},z="upload"===a.type&&a.uploadMetadata?.verificationStatus==="pending";return d?(0,b.jsx)(u.AnimatePresence,{children:(0,b.jsx)(t.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:e,children:(0,b.jsxs)(t.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[var(--color-surface)] rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col border border-[var(--color-border)]",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--color-border)]",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] truncate",children:a.title}),a.version>1&&(0,b.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:["v",a.version]})]}),(0,b.jsx)("button",{onClick:e,className:"p-2 rounded-lg text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-hover)] transition-colors ml-4",children:(0,b.jsx)(r.X,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsx)(n.Badge,{variant:"active"===a.status?"success":"pending_signature"===a.status?"warning":"secondary",children:E[a.status].label}),(0,b.jsx)(n.Badge,{variant:"outline",children:F[a.category]}),"docusign"===a.type&&(0,b.jsx)(n.Badge,{variant:"outline",children:"DocuSign"}),z&&(0,b.jsx)(n.Badge,{variant:"warning",children:"Pendiente Verificacion"})]}),a.description&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Descripcion"}),(0,b.jsx)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:a.description})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[a.effectiveDate&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,b.jsx)(C.Calendar,{className:"h-4 w-4"}),"Fecha de vigencia"]}),(0,b.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:w(a.effectiveDate)})]}),a.expirationDate&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,b.jsx)(C.Calendar,{className:"h-4 w-4"}),"Fecha de vencimiento"]}),(0,b.jsx)("p",{className:(0,q.cn)("text-sm font-medium",new Date(a.expirationDate)<new Date?"text-red-500":"text-[var(--color-text-primary)]"),children:w(a.expirationDate)})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,b.jsx)(y.User,{className:"h-4 w-4"}),"Creado por"]}),(0,b.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:a.createdByName||"Desconocido"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,b.jsx)(C.Calendar,{className:"h-4 w-4"}),"Fecha de creacion"]}),(0,b.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:w(a.createdAt)})]})]}),"docusign"===a.type&&a.docusignMetadata?.signers&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-3",children:"Firmas"}),(0,b.jsx)("div",{className:"space-y-2",children:a.docusignMetadata.signers.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-[var(--color-surface-hover)] rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-[var(--color-primary)]/10 flex items-center justify-center",children:(0,b.jsx)(y.User,{className:"h-4 w-4 text-[var(--color-primary)]"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-[var(--color-text-secondary)]",children:["sovra"===a.role?"Sovra":"Partner"," - ",a.email]})]})]}),(0,b.jsx)("div",{className:"text-right",children:"signed"===a.status?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Badge,{variant:"success",className:"text-xs",children:"Firmado"}),a.signedAt&&(0,b.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:v(a.signedAt)})]}):"declined"===a.status?(0,b.jsx)(n.Badge,{variant:"destructive",className:"text-xs",children:"Rechazado"}):(0,b.jsx)(n.Badge,{variant:"warning",className:"text-xs",children:"Pendiente"})})]},c))})]}),"upload"===a.type&&a.uploadMetadata&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-3",children:"Informacion del archivo"}),(0,b.jsxs)("div",{className:"p-3 bg-[var(--color-surface-hover)] rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"Nombre del archivo"}),(0,b.jsx)("span",{className:"text-[var(--color-text-primary)]",children:a.uploadMetadata.fileName})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"Subido por"}),(0,b.jsxs)("span",{className:"text-[var(--color-text-primary)]",children:[a.uploadMetadata.uploadedByName,"sovra"===a.uploadMetadata.uploadedBy?" (Sovra)":" (Partner)"]})]}),a.uploadMetadata.verificationStatus&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"Estado de verificacion"}),(0,b.jsx)(n.Badge,{variant:"verified"===a.uploadMetadata.verificationStatus?"success":"rejected"===a.uploadMetadata.verificationStatus?"destructive":"warning",children:"verified"===a.uploadMetadata.verificationStatus?"Verificado":"rejected"===a.uploadMetadata.verificationStatus?"Rechazado":"Pendiente"})]})]})]}),g.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-3",children:"Historial"}),(0,b.jsx)("div",{className:"space-y-3",children:g.map(a=>{var c;let d=(a=>{switch(a){case"created":case"uploaded":default:return k.FileText;case"signed":return h.CheckCircle;case"sent_for_signature":return i.Clock;case"declined":case"rejected":return j.AlertTriangle;case"verified":return D.Shield}})(a.action);return(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-[var(--color-surface-hover)] flex items-center justify-center",children:(0,b.jsx)(d,{className:"h-4 w-4 text-[var(--color-text-secondary)]"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("p",{className:"text-sm text-[var(--color-text-primary)]",children:[{created:"Documento creado",uploaded:"Documento subido",signed:"Firmado",sent_for_signature:"Enviado para firma",viewed:"Visualizado",downloaded:"Descargado",declined:"Rechazado",rejected:"Rechazado",expired:"Expirado",archived:"Archivado",new_version_created:"Nueva version creada",verified:"Verificado"}[c=a.action]||c,a.actorName&&(0,b.jsxs)("span",{className:"text-[var(--color-text-secondary)]",children:[" - ",a.actorName]})]}),(0,b.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)]",children:v(a.timestamp)})]})]},a.id)})})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-[var(--color-border)]",children:[z&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Button,{variant:"outline",onClick:()=>x(!1),children:"Rechazar"}),(0,b.jsxs)(m.Button,{onClick:()=>x(!0),children:[(0,b.jsx)(h.CheckCircle,{className:"h-4 w-4 mr-2"}),"Verificar"]})]}),"docusign"===a.type&&a.docusignMetadata?.certificateUrl&&(0,b.jsxs)(m.Button,{variant:"outline",children:[(0,b.jsx)(D.Shield,{className:"h-4 w-4 mr-2"}),"Descargar Certificado"]}),(0,b.jsxs)(m.Button,{variant:"outline",children:[(0,b.jsx)(B.Download,{className:"h-4 w-4 mr-2"}),"Descargar"]})]})]})})}):null}let H={draft:{color:"text-[var(--color-text-secondary)]",bgColor:"bg-[var(--color-surface-hover)]",label:"Borrador"},pending_signature:{color:"text-amber-500",bgColor:"bg-amber-500/10",label:"Pendiente Firma"},partially_signed:{color:"text-[var(--color-primary)]",bgColor:"bg-[var(--color-primary)]/10",label:"Parcialmente Firmado"},active:{color:"text-green-500",bgColor:"bg-green-500/10",label:"Activo"},expired:{color:"text-red-500",bgColor:"bg-red-500/10",label:"Expirado"},superseded:{color:"text-[var(--color-text-muted)]",bgColor:"bg-[var(--color-surface-hover)]",label:"Reemplazado"},archived:{color:"text-[var(--color-text-muted)]",bgColor:"bg-[var(--color-surface-hover)]",label:"Archivado"}},I={contract:"Contrato",amendment:"Addendum",compliance:"Compliance",financial:"Financiero",certification:"Certificacion",policy:"Politica",correspondence:"Correspondencia"};function J(){let[a,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(null),[j,n]=(0,c.useState)([]),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)("all"),[w,y]=(0,c.useState)("all"),[z,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null);(0,c.useEffect)(()=>{!async function(){try{let a=await fetch("/api/sovra/partners");if(a.ok){let b=await a.json();g(b.partners||[])}}catch(a){console.error("Failed to fetch partners:",a)}finally{r(!1)}}()},[]);let J=(0,c.useCallback)(async()=>{if(!h)return void n([]);try{let a=await fetch(`/api/sovra/documents?partnerId=${h.id}`);if(a.ok){let b=await a.json();n(b.documents||[])}}catch(a){console.error("Failed to fetch documents:",a)}},[h]);(0,c.useEffect)(()=>{J()},[J]);let L=j.filter(a=>{if(s){let b=s.toLowerCase();if(!a.title.toLowerCase().includes(b)&&!a.description?.toLowerCase().includes(b))return!1}return("all"===u||a.category===u)&&("all"===w||a.status===w)}),M=L.filter(a=>"pending_signature"===a.status||"partially_signed"===a.status||"upload"===a.type&&a.uploadMetadata?.verificationStatus==="pending"),N=L.filter(a=>"active"===a.status&&("upload"!==a.type||a.uploadMetadata?.verificationStatus!=="pending")),O=L.filter(a=>!M.includes(a)&&!N.includes(a)),P=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return q?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(p.SovraLoader,{size:"md",className:"text-[var(--color-primary)]"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:["Documentos ",(0,b.jsx)("span",{className:"text-[var(--color-primary)]",children:"Legales"})]}),(0,b.jsx)("p",{className:"text-[var(--color-text-secondary)]",children:"Gestiona documentos y contratos de partners"})]}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"p-4",children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-2",children:[(0,b.jsx)(l.Users,{className:"inline h-4 w-4 mr-2"}),"Seleccionar Partner"]}),(0,b.jsxs)("select",{value:h?.id||"",onChange:b=>{i(a.find(a=>a.id===b.target.value)||null)},className:"w-full md:w-96 px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,b.jsx)("option",{value:"",children:"-- Selecciona un partner --"}),a.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.companyName," (",a.name,")"]},a.id))]}),h&&(0,b.jsxs)("div",{className:"mt-2 text-xs text-[var(--color-text-secondary)]",children:["Partner ID: ",(0,b.jsx)("code",{className:"bg-[var(--color-surface-hover)] px-1 py-0.5 rounded",children:h.id})," • ","Tier: ",(0,b.jsx)("span",{className:"capitalize",children:h.tier})," • ","Email: ",h.email]})]})}),h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,b.jsxs)(m.Button,{onClick:()=>D(!0),children:[(0,b.jsx)(e.Send,{className:"h-4 w-4 mr-2"}),"Enviar Contrato DocuSign"]}),(0,b.jsxs)(m.Button,{variant:"outline",onClick:()=>B(!0),children:[(0,b.jsx)(f.Upload,{className:"h-4 w-4 mr-2"}),"Compartir Documento"]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(d.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-[var(--color-text-secondary)]"}),(0,b.jsx)("input",{type:"text",placeholder:"Buscar documentos...",value:s,onChange:a=>t(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-[var(--color-text-muted)]"})]}),(0,b.jsxs)("select",{value:u,onChange:a=>v(a.target.value),className:"px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,b.jsx)("option",{value:"all",children:"Todas las categorias"}),Object.entries(I).map(([a,c])=>(0,b.jsx)("option",{value:a,children:c},a))]}),(0,b.jsxs)("select",{value:w,onChange:a=>y(a.target.value),className:"px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,b.jsx)("option",{value:"all",children:"Todos los estados"}),Object.entries(H).map(([a,c])=>(0,b.jsx)("option",{value:a,children:c.label},a))]})]}),0===L.length?(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(k.FileText,{className:"mx-auto h-12 w-12 text-[var(--color-text-muted)]"}),(0,b.jsx)("p",{className:"mt-4 text-[var(--color-text-secondary)]",children:0===j.length?"No hay documentos para este partner":"No se encontraron documentos con los filtros aplicados"})]})}):(0,b.jsxs)("div",{className:"space-y-6",children:[M.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-3 flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-amber-500"}),"Requieren Accion (",M.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:M.map(a=>(0,b.jsx)(K,{document:a,onView:()=>F(a),onRefresh:J,formatDate:P},a.id))})]}),N.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-3 flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-500"}),"Documentos Activos (",N.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:N.map(a=>(0,b.jsx)(K,{document:a,onView:()=>F(a),onRefresh:J,formatDate:P},a.id))})]}),O.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-3 flex items-center gap-2",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-[var(--color-text-muted)]"}),"Otros (",O.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:O.map(a=>(0,b.jsx)(K,{document:a,onView:()=>F(a),onRefresh:J,formatDate:P},a.id))})]})]})]}),h&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x,{isOpen:z,onClose:()=>B(!1),partner:h,onSuccess:()=>{B(!1),J()}}),(0,b.jsx)(A,{isOpen:C,onClose:()=>D(!1),partner:h,onSuccess:()=>{D(!1),J()}})]}),E&&(0,b.jsx)(G,{document:E,isOpen:!!E,onClose:()=>F(null),onRefresh:J})]})}function K({document:a,onView:c,onRefresh:d,formatDate:e}){let f=H[a.status],l="upload"===a.type&&a.uploadMetadata?.verificationStatus==="pending",p=async b=>{try{(await fetch(`/api/sovra/documents/${a.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b?"verified":"rejected",notes:b?"Documento verificado por admin":"Documento rechazado por admin"})})).ok&&d()}catch(a){console.error("Failed to verify document:",a)}};return(0,b.jsx)(o.Card,{className:"hover:shadow-md transition-shadow",children:(0,b.jsx)(o.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:(0,q.cn)("h-10 w-10 rounded-lg flex items-center justify-center",f.bgColor),children:"active"===a.status?(0,b.jsx)(h.CheckCircle,{className:(0,q.cn)("h-5 w-5",f.color)}):"pending_signature"===a.status||"partially_signed"===a.status?(0,b.jsx)(i.Clock,{className:(0,q.cn)("h-5 w-5",f.color)}):"expired"===a.status?(0,b.jsx)(j.AlertTriangle,{className:(0,q.cn)("h-5 w-5",f.color)}):(0,b.jsx)(k.FileText,{className:(0,q.cn)("h-5 w-5",f.color)})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h3",{className:"font-medium text-[var(--color-text-primary)] truncate",children:a.title}),a.version>1&&(0,b.jsxs)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["v",a.version]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[(0,b.jsx)(n.Badge,{variant:"secondary",className:"text-xs",children:I[a.category]}),(0,b.jsx)(n.Badge,{variant:"docusign"===a.type?"outline":"secondary",className:"text-xs",children:"docusign"===a.type?"DocuSign":"Subido"}),l&&(0,b.jsx)(n.Badge,{variant:"warning",className:"text-xs",children:"Pendiente Verificacion"})]}),(0,b.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)] mt-1",children:[a.createdAt&&`Creado: ${e(a.createdAt)}`,a.expirationDate&&` | Expira: ${e(a.expirationDate)}`]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(m.Button,{size:"sm",onClick:()=>p(!0),children:[(0,b.jsx)(h.CheckCircle,{className:"h-4 w-4 mr-1"}),"Verificar"]}),(0,b.jsx)(m.Button,{size:"sm",variant:"outline",onClick:()=>p(!1),children:"Rechazar"})]}),(0,b.jsx)(m.Button,{size:"sm",variant:"outline",onClick:c,children:(0,b.jsx)(g.Eye,{className:"h-4 w-4"})})]})]})})})}a.s(["default",()=>J],67242)}];

//# sourceMappingURL=37f04_partners-portal_src_app_%5Blocale%5D_sovra_dashboard_documents_page_tsx_d5b2cd31._.js.map