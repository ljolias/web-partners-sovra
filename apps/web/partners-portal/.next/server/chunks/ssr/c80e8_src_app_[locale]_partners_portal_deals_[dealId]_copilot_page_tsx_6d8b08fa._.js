module.exports=[59936,a=>{"use strict";var b=a.i(34076),c=a.i(88972),d=a.i(24321),e=a.i(53440),f=a.i(72284),g=a.i(14855),h=a.i(82840);a.i(96149);var i=a.i(68956),j=a.i(45968),k=a.i(41165),l=a.i(34887);let m=(0,a.i(53659).default)("circle-stop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);var n=a.i(55385),o=a.i(92032),p=a.i(41203),q=a.i(29432),r=a.i(76469),s=a.i(89859),t=a.i(6373),u=a.i(37474);function v({deal:a,onScoreUpdate:d}){let f=(0,e.useTranslations)("copilot"),g=(0,e.useTranslations)("meddic"),[h,j]=(0,c.useState)(""),k=(0,c.useRef)(null),v=(0,c.useRef)(null),{messages:w,isLoading:x,sendMessage:y,cancelRequest:z}=function({dealId:a,onScoreSuggestion:b}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(null),l=(0,c.useRef)(null),m=(0,c.useCallback)(async()=>{try{let b=await fetch("/api/partners/copilot/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dealId:a})});if(!b.ok)throw Error("Failed to start session");let c=await b.json();return i(c.sessionId),e(c.messages||[]),c.sessionId}catch(a){return k(a instanceof Error?a.message:"Failed to start session"),null}},[a]),n=(0,c.useCallback)(async c=>{if(!h&&!await m())return;let d={id:`msg-${Date.now()}`,role:"user",content:c,createdAt:new Date().toISOString()};e(a=>[...a,d]),g(!0),k(null),l.current=new AbortController;try{let d=await fetch("/api/partners/copilot/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:h,dealId:a,message:c}),signal:l.current.signal});if(!d.ok)throw Error("Failed to send message");let f=d.body?.getReader();if(!f)throw Error("No response body");let g=new TextDecoder,i={id:`msg-${Date.now()+1}`,role:"assistant",content:"",createdAt:new Date().toISOString()};e(a=>[...a,i]);let j="";for(;;){let{done:a,value:c}=await f.read();if(a)break;for(let a of g.decode(c,{stream:!0}).split("\n"))if(a.startsWith("data: ")){let c=a.slice(6);if("[DONE]"===c)continue;try{let a=JSON.parse(c);a.content&&(j+=a.content,e(a=>a.map(a=>a.id===i.id?{...a,content:j}:a))),a.suggestedScores&&b&&(b(a.suggestedScores),e(b=>b.map(b=>b.id===i.id?{...b,suggestedScores:a.suggestedScores}:b)))}catch{}}}}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;k(a instanceof Error?a.message:"Failed to send message")}finally{g(!1),l.current=null}},[h,a,m,b]);return{messages:d,isLoading:f,error:j,sessionId:h,startSession:m,sendMessage:n,cancelRequest:(0,c.useCallback)(()=>{l.current?.abort(),g(!1)},[]),clearMessages:(0,c.useCallback)(()=>{e([]),i(null)},[])}}({dealId:a.id,onScoreSuggestion:a=>{}});(0,c.useEffect)(()=>{k.current?.scrollIntoView({behavior:"smooth"})},[w]);let A=async a=>{if(a.preventDefault(),!h.trim()||x)return;let b=h.trim();j(""),await y(b)};return(0,b.jsxs)("div",{className:"flex h-[600px] flex-col rounded-xl border border-gray-200 bg-white",children:[(0,b.jsx)("div",{className:"border-b border-gray-200 px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-100",children:(0,b.jsx)(n.Bot,{className:"h-5 w-5 text-indigo-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:f("title")}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:f("subtitle")})]})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(s.AnimatePresence,{initial:!1,children:w.map(a=>(0,b.jsxs)(r.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:(0,u.cn)("flex gap-3","user"===a.role?"justify-end":"justify-start"),children:["assistant"===a.role&&(0,b.jsx)("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100",children:(0,b.jsx)(n.Bot,{className:"h-4 w-4 text-indigo-600"})}),(0,b.jsxs)("div",{className:(0,u.cn)("max-w-[80%] rounded-2xl px-4 py-3","user"===a.role?"bg-indigo-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,b.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:a.content}),a.suggestedScores&&Object.keys(a.suggestedScores).length>0&&(0,b.jsxs)("div",{className:"mt-3 rounded-lg bg-white p-3 shadow-sm",children:[(0,b.jsx)("p",{className:"mb-2 text-xs font-medium text-gray-500",children:f("scoreSuggestion")}),(0,b.jsx)("div",{className:"space-y-2",children:Object.entries(a.suggestedScores).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-gray-700",children:g(a)}),(0,b.jsxs)(t.Badge,{variant:"info",children:[c,"/5"]})]},a))}),(0,b.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,b.jsxs)(i.Button,{size:"sm",onClick:()=>{a.suggestedScores&&d&&d(a.suggestedScores)},children:[(0,b.jsx)(p.Check,{className:"mr-1 h-3 w-3"}),f("acceptScore")]}),(0,b.jsxs)(i.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(q.X,{className:"mr-1 h-3 w-3"}),f("rejectScore")]})]})]})]}),"user"===a.role&&(0,b.jsx)("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-gray-200",children:(0,b.jsx)(o.User,{className:"h-4 w-4 text-gray-600"})})]},a.id))}),x&&w[w.length-1]?.role==="user"&&(0,b.jsxs)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100",children:(0,b.jsx)(n.Bot,{className:"h-4 w-4 text-indigo-600"})}),(0,b.jsx)("div",{className:"rounded-2xl bg-gray-100 px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("span",{className:"h-2 w-2 animate-bounce rounded-full bg-gray-400",style:{animationDelay:"0ms"}}),(0,b.jsx)("span",{className:"h-2 w-2 animate-bounce rounded-full bg-gray-400",style:{animationDelay:"150ms"}}),(0,b.jsx)("span",{className:"h-2 w-2 animate-bounce rounded-full bg-gray-400",style:{animationDelay:"300ms"}})]}),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:f("thinking")})]})})]}),(0,b.jsx)("div",{ref:k})]})}),(0,b.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,b.jsxs)("form",{onSubmit:A,className:"flex gap-3",children:[(0,b.jsx)("textarea",{ref:v,value:h,onChange:a=>j(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),A(a))},placeholder:f("placeholder"),rows:1,className:"flex-1 resize-none rounded-lg border border-gray-300 px-4 py-3 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/20"}),x?(0,b.jsx)(i.Button,{type:"button",variant:"outline",onClick:z,children:(0,b.jsx)(m,{className:"h-5 w-5"})}):(0,b.jsx)(i.Button,{type:"submit",disabled:!h.trim(),children:(0,b.jsx)(l.Send,{className:"h-5 w-5"})})]})})]})}function w({params:a}){let{locale:l,dealId:m}=(0,c.use)(a),n=(0,d.useRouter)(),o=(0,e.useTranslations)("copilot"),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{!async function(){try{let a=await fetch(`/api/partners/deals/${m}`);if(a.ok){let b=await a.json();q(b.deal)}else n.push(`/${l}/partners/portal/deals`)}catch{n.push(`/${l}/partners/portal/deals`)}finally{s(!1)}}()},[m,l,n]),r)?(0,b.jsx)("div",{className:"flex h-96 items-center justify-center",children:(0,b.jsx)(k.SovraLoader,{size:"md",className:"text-[var(--color-primary)]"})}):p?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(h.default,{href:`/${l}/partners/portal/deals/${m}`,children:(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",children:[(0,b.jsx)(f.ArrowLeft,{className:"mr-2 h-4 w-4"}),"Back to Deal"]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:o("title")}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:p.clientName})]})]}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsx)(v,{deal:p})}),(0,b.jsx)("div",{children:(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Building2,{className:"w-5 h-5"}),"Informacion del Deal"]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Cliente"}),(0,b.jsx)("p",{className:"font-medium",children:p.clientName})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Pais"}),(0,b.jsx)("p",{className:"font-medium",children:p.country})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Poblacion"}),(0,b.jsxs)("p",{className:"font-medium",children:[p.population.toLocaleString()," habitantes"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Contacto"}),(0,b.jsx)("p",{className:"font-medium",children:p.contactName}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:p.contactRole})]})]})]})})]})]}):null}a.s(["default",()=>w],59936)}];

//# sourceMappingURL=c80e8_src_app_%5Blocale%5D_partners_portal_deals_%5BdealId%5D_copilot_page_tsx_6d8b08fa._.js.map