(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,58724,e=>{"use strict";var r=e.i(98134),a=e.i(75201),t=e.i(65153),o=e.i(26358),s=e.i(25194),l=e.i(94810),c=e.i(50576),i=e.i(83635),n=e.i(98952),d=e.i(16815),m=e.i(36003);e.i(75315);var x=e.i(64833),u=e.i(97422),p=e.i(96215),v=e.i(44449),h=e.i(13879),f=e.i(55995),g=e.i(39786),j=e.i(78033),b=e.i(76927);let y=[{value:"financial",label:"Financiero",description:"Reportes de comisiones, facturas, etc."},{value:"policy",label:"Politica",description:"Manuales, guias de uso, politicas"},{value:"compliance",label:"Compliance",description:"Documentos de cumplimiento"},{value:"correspondence",label:"Correspondencia",description:"Cartas y comunicaciones formales"},{value:"certification",label:"Certificacion",description:"Certificados y acreditaciones"}],N=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/png","image/jpeg"];function w({isOpen:e,onClose:t,partner:o,onSuccess:l}){let[c,i]=(0,a.useState)(""),[n,m]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[v,h]=(0,a.useState)(null),[w,C]=(0,a.useState)(""),[S,D]=(0,a.useState)(!1),[k,P]=(0,a.useState)(""),[F,E]=(0,a.useState)(!1),B=(0,a.useRef)(null),A=()=>{i(""),m(""),p(""),h(null),C(""),P("")},T=()=>{A(),t()},z=e=>{if(!e)return;let r=e.size>0xa00000?"El archivo excede el tamano maximo de 10MB":N.includes(e.type)?null:"Tipo de archivo no permitido. Usa PDF, DOC, DOCX, XLS, XLSX, PNG o JPG";r?P(r):(h(e),P(""),c||i(e.name.replace(/\.[^/.]+$/,"")))},M=async e=>{if(e.preventDefault(),!v||!u||!c)return void P("Por favor completa todos los campos requeridos");D(!0),P("");try{let e=new FormData;e.append("file",v),e.append("title",c),e.append("description",n),e.append("category",u),e.append("partnerId",o.id),w&&e.append("expirationDate",w);let r=await fetch("/api/sovra/documents",{method:"POST",body:e});if(!r.ok){let e=await r.json();throw Error(e.error||"Error al subir el documento")}A(),l()}catch(e){P(e instanceof Error?e.message:"Error al subir el documento")}finally{D(!1)}};return e?(0,r.jsx)(b.AnimatePresence,{children:(0,r.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:T,children:(0,r.jsxs)(j.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[var(--color-surface)] rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-hidden border border-[var(--color-border)]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--color-border)]",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"Compartir Documento"}),(0,r.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:["con ",o.companyName]})]}),(0,r.jsx)("button",{onClick:T,className:"p-2 rounded-lg text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-hover)] transition-colors",children:(0,r.jsx)(f.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("form",{onSubmit:M,className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-140px)]",children:[k&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 text-red-500 rounded-lg text-sm",children:[(0,r.jsx)(g.AlertCircle,{className:"h-4 w-4 flex-shrink-0"}),k]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Categoria *"}),(0,r.jsxs)("select",{value:u,onChange:e=>p(e.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,r.jsx)("option",{value:"",children:"Selecciona una categoria"}),y.map(e=>(0,r.jsxs)("option",{value:e.value,children:[e.label," - ",e.description]},e.value))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Titulo del documento *"}),(0,r.jsx)("input",{type:"text",value:c,onChange:e=>i(e.target.value),required:!0,placeholder:"Ej: Reporte de Comisiones Q4 2025",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-[var(--color-text-muted)]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Descripcion (opcional)"}),(0,r.jsx)("textarea",{value:n,onChange:e=>m(e.target.value),rows:2,placeholder:"Descripcion breve del documento...",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] resize-none placeholder:text-[var(--color-text-muted)]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Fecha de vencimiento (opcional)"}),(0,r.jsx)("input",{type:"date",value:w,onChange:e=>C(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Archivo *"}),(0,r.jsxs)("div",{onDragOver:e=>{e.preventDefault(),E(!0)},onDragLeave:()=>E(!1),onDrop:e=>{e.preventDefault(),E(!1),z(e.dataTransfer.files[0])},onClick:()=>B.current?.click(),className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${F?"border-[var(--color-primary)] bg-[var(--color-primary)]/10":v?"border-green-500 bg-green-500/10":"border-[var(--color-border)] hover:border-[var(--color-border-hover)]"}`,children:[(0,r.jsx)("input",{ref:B,type:"file",onChange:e=>z(e.target.files?.[0]||null),accept:".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg",className:"hidden"}),v?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)(d.FileText,{className:"h-6 w-6 text-green-500"}),(0,r.jsx)("span",{className:"text-sm text-green-500 font-medium",children:v.name}),(0,r.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),h(null)},className:"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]",children:(0,r.jsx)(f.X,{className:"h-4 w-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Upload,{className:"mx-auto h-8 w-8 text-[var(--color-text-muted)]"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[var(--color-text-secondary)]",children:"Arrastra un archivo o haz clic para seleccionar"}),(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"PDF, DOC, DOCX, XLS, XLSX, PNG, JPG (max 10MB)"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-[var(--color-border)]",children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:T,disabled:S,children:"Cancelar"}),(0,r.jsx)(x.Button,{onClick:M,disabled:S||!v||!u||!c,children:S?"Subiendo...":"Compartir Documento"})]})]})})}):null}var C=e.i(91427);let S=[{value:"contract",label:"Contrato",description:"Acuerdos principales, NDA, etc."},{value:"amendment",label:"Addendum",description:"Modificaciones a contratos existentes"}];function D({isOpen:e,onClose:t,partner:l,onSuccess:c}){let[i,n]=(0,a.useState)(""),[m,u]=(0,a.useState)(""),[p,v]=(0,a.useState)("contract"),[h,y]=(0,a.useState)(null),[N,w]=(0,a.useState)(""),[D,k]=(0,a.useState)(""),[P,F]=(0,a.useState)(l.contactName||l.name||""),[E,B]=(0,a.useState)(l.contactEmail||l.email||""),[A,T]=(0,a.useState)("Legal Sovra"),[z,M]=(0,a.useState)("legal@sovra.io"),[O,R]=(0,a.useState)(!1),[L,_]=(0,a.useState)(""),[$,X]=(0,a.useState)(!1),q=(0,a.useRef)(null),U=()=>{n(""),u(""),v("contract"),y(null),w(""),k(""),F(l.contactName||l.name||""),B(l.contactEmail||l.email||""),T("Legal Sovra"),M("legal@sovra.io"),_("")},V=()=>{U(),t()},I=e=>{if(!e)return;let r=e.size>0xa00000?"El archivo excede el tamano maximo de 10MB":"application/pdf"!==e.type?"Solo se permiten archivos PDF para contratos DocuSign":null;r?_(r):(y(e),_(""),i||n(e.name.replace(/\.[^/.]+$/,"")))},G=async e=>{if(e.preventDefault(),!h||!p||!i||!E||!z)return void _("Por favor completa todos los campos requeridos");let r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!r.test(E)||!r.test(z))return void _("Por favor ingresa emails validos");R(!0),_("");try{let e=new FormData;e.append("file",h),e.append("title",i),e.append("description",m),e.append("category",p),e.append("partnerId",l.id),N&&e.append("effectiveDate",N),D&&e.append("expirationDate",D),e.append("partnerSignerName",P),e.append("partnerSignerEmail",E),e.append("sovraSignerName",A),e.append("sovraSignerEmail",z);let r=await fetch("/api/sovra/documents/send-contract",{method:"POST",body:e}),a=await r.json();if(!r.ok)throw Error(a.error||"Error al enviar el contrato");console.log("[SendContractModal] Document created:",a.document?.id,"for partner:",l.id),alert(`Documento creado exitosamente!

ID: ${a.document?.id}
Partner: ${l.companyName} (${l.id})

Nota: DocuSign esta en modo demo, los emails no se enviaran.`),U(),c()}catch(e){_(e instanceof Error?e.message:"Error al enviar el contrato")}finally{R(!1)}};return e?(0,r.jsx)(b.AnimatePresence,{children:(0,r.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:V,children:(0,r.jsxs)(j.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[var(--color-surface)] rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden border border-[var(--color-border)]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--color-border)]",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"Enviar Contrato DocuSign"}),(0,r.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:["a ",l.companyName]})]}),(0,r.jsx)("button",{onClick:V,className:"p-2 rounded-lg text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-hover)] transition-colors",children:(0,r.jsx)(f.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("form",{onSubmit:G,className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-140px)]",children:[L&&(0,r.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 text-red-500 rounded-lg text-sm",children:[(0,r.jsx)(g.AlertCircle,{className:"h-4 w-4 flex-shrink-0"}),L]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Tipo de contrato *"}),(0,r.jsx)("select",{value:p,onChange:e=>v(e.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:S.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Titulo del contrato *"}),(0,r.jsx)("input",{type:"text",value:i,onChange:e=>n(e.target.value),required:!0,placeholder:"Ej: Acuerdo de Partner 2026",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-[var(--color-text-muted)]"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Descripcion (opcional)"}),(0,r.jsx)("textarea",{value:m,onChange:e=>u(e.target.value),rows:2,placeholder:"Descripcion breve del contrato...",className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] resize-none placeholder:text-[var(--color-text-muted)]"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Fecha de vigencia"}),(0,r.jsx)("input",{type:"date",value:N,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Fecha de vencimiento"}),(0,r.jsx)("input",{type:"date",value:D,onChange:e=>k(e.target.value),min:N||new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]})]}),(0,r.jsxs)("div",{className:"border border-[var(--color-border)] rounded-lg p-4 space-y-4",children:[(0,r.jsxs)("h3",{className:"font-medium text-[var(--color-text-primary)] flex items-center gap-2",children:[(0,r.jsx)(C.User,{className:"h-4 w-4"}),"Firmantes"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Nombre del Partner *"}),(0,r.jsx)("input",{type:"text",value:P,onChange:e=>F(e.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Email del Partner *"}),(0,r.jsx)("input",{type:"email",value:E,onChange:e=>B(e.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Nombre de Sovra *"}),(0,r.jsx)("input",{type:"text",value:A,onChange:e=>T(e.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-[var(--color-text-secondary)] mb-1",children:"Email de Sovra *"}),(0,r.jsx)("input",{type:"email",value:z,onChange:e=>M(e.target.value),required:!0,className:"w-full px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Documento PDF *"}),(0,r.jsxs)("div",{onDragOver:e=>{e.preventDefault(),X(!0)},onDragLeave:()=>X(!1),onDrop:e=>{e.preventDefault(),X(!1),I(e.dataTransfer.files[0])},onClick:()=>q.current?.click(),className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${$?"border-[var(--color-primary)] bg-[var(--color-primary)]/10":h?"border-green-500 bg-green-500/10":"border-[var(--color-border)] hover:border-[var(--color-border-hover)]"}`,children:[(0,r.jsx)("input",{ref:q,type:"file",onChange:e=>I(e.target.files?.[0]||null),accept:".pdf",className:"hidden"}),h?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)(d.FileText,{className:"h-6 w-6 text-green-500"}),(0,r.jsx)("span",{className:"text-sm text-green-500 font-medium",children:h.name}),(0,r.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),y(null)},className:"text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]",children:(0,r.jsx)(f.X,{className:"h-4 w-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Upload,{className:"mx-auto h-8 w-8 text-[var(--color-text-muted)]"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-[var(--color-text-secondary)]",children:"Arrastra un archivo PDF o haz clic para seleccionar"}),(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-muted)] mt-1",children:"Solo archivos PDF (max 10MB)"})]})]})]}),(0,r.jsx)("div",{className:"bg-[var(--color-primary)]/10 rounded-lg p-3 text-sm text-[var(--color-primary)]",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Nota:"})," El contrato sera enviado a ambos firmantes via DocuSign. Recibiran un email con el enlace para firmar."]})}),(0,r.jsx)("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-sm text-amber-600 dark:text-amber-400",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Modo Demo:"})," DocuSign no esta configurado. Los documentos se crearan pero los emails de firma no se enviaran. Para activar DocuSign, configura las variables de entorno necesarias."]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-[var(--color-border)]",children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:V,disabled:O,children:"Cancelar"}),(0,r.jsxs)(x.Button,{onClick:G,disabled:O||!h||!i,children:[(0,r.jsx)(o.Send,{className:"h-4 w-4 mr-2"}),O?"Enviando...":"Enviar Contrato"]})]})]})})}):null}var k=e.i(84710),P=e.i(78516),F=e.i(90224);let E={draft:{color:"text-[var(--color-text-secondary)]",label:"Borrador"},pending_signature:{color:"text-amber-500",label:"Pendiente Firma"},partially_signed:{color:"text-[var(--color-primary)]",label:"Parcialmente Firmado"},active:{color:"text-green-500",label:"Activo"},expired:{color:"text-red-500",label:"Expirado"},superseded:{color:"text-[var(--color-text-muted)]",label:"Reemplazado"},archived:{color:"text-[var(--color-text-muted)]",label:"Archivado"}},B={contract:"Contrato",amendment:"Addendum",compliance:"Compliance",financial:"Financiero",certification:"Certificacion",policy:"Politica",correspondence:"Correspondencia"};function A({document:e,isOpen:t,onClose:o,onRefresh:s}){let[l,m]=(0,a.useState)([]),[p,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&e.id&&g()},[t,e.id]);let g=async()=>{v(!0);try{let r=await fetch(`/api/sovra/documents/${e.id}`);if(r.ok){let e=await r.json();m(e.auditEvents||[])}}catch(e){console.error("Failed to fetch audit events:",e)}finally{v(!1)}},y=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),w=async r=>{try{(await fetch(`/api/sovra/documents/${e.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:r?"verified":"rejected",notes:r?"Documento verificado por admin":"Documento rechazado por admin"})})).ok&&(s(),o())}catch(e){console.error("Failed to verify document:",e)}},S="upload"===e.type&&e.uploadMetadata?.verificationStatus==="pending";return t?(0,r.jsx)(b.AnimatePresence,{children:(0,r.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:o,children:(0,r.jsxs)(j.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[var(--color-surface)] rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col border border-[var(--color-border)]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--color-border)]",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] truncate",children:e.title}),e.version>1&&(0,r.jsxs)("span",{className:"text-sm text-[var(--color-text-secondary)]",children:["v",e.version]})]}),(0,r.jsx)("button",{onClick:o,className:"p-2 rounded-lg text-[var(--color-text-secondary)] hover:bg-[var(--color-surface-hover)] transition-colors ml-4",children:(0,r.jsx)(f.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,r.jsx)(u.Badge,{variant:"active"===e.status?"success":"pending_signature"===e.status?"warning":"secondary",children:E[e.status].label}),(0,r.jsx)(u.Badge,{variant:"outline",children:B[e.category]}),"docusign"===e.type&&(0,r.jsx)(u.Badge,{variant:"outline",children:"DocuSign"}),S&&(0,r.jsx)(u.Badge,{variant:"warning",children:"Pendiente Verificacion"})]}),e.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-1",children:"Descripcion"}),(0,r.jsx)("p",{className:"text-sm text-[var(--color-text-secondary)]",children:e.description})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[e.effectiveDate&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,r.jsx)(P.Calendar,{className:"h-4 w-4"}),"Fecha de vigencia"]}),(0,r.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:N(e.effectiveDate)})]}),e.expirationDate&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,r.jsx)(P.Calendar,{className:"h-4 w-4"}),"Fecha de vencimiento"]}),(0,r.jsx)("p",{className:(0,h.cn)("text-sm font-medium",new Date(e.expirationDate)<new Date?"text-red-500":"text-[var(--color-text-primary)]"),children:N(e.expirationDate)})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,r.jsx)(C.User,{className:"h-4 w-4"}),"Creado por"]}),(0,r.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:e.createdByName||"Desconocido"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[var(--color-text-secondary)] mb-1",children:[(0,r.jsx)(P.Calendar,{className:"h-4 w-4"}),"Fecha de creacion"]}),(0,r.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:N(e.createdAt)})]})]}),"docusign"===e.type&&e.docusignMetadata?.signers&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-3",children:"Firmas"}),(0,r.jsx)("div",{className:"space-y-2",children:e.docusignMetadata.signers.map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-[var(--color-surface-hover)] rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"h-8 w-8 rounded-full bg-[var(--color-primary)]/10 flex items-center justify-center",children:(0,r.jsx)(C.User,{className:"h-4 w-4 text-[var(--color-primary)]"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-[var(--color-text-primary)]",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-[var(--color-text-secondary)]",children:["sovra"===e.role?"Sovra":"Partner"," - ",e.email]})]})]}),(0,r.jsx)("div",{className:"text-right",children:"signed"===e.status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Badge,{variant:"success",className:"text-xs",children:"Firmado"}),e.signedAt&&(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)] mt-1",children:y(e.signedAt)})]}):"declined"===e.status?(0,r.jsx)(u.Badge,{variant:"destructive",className:"text-xs",children:"Rechazado"}):(0,r.jsx)(u.Badge,{variant:"warning",className:"text-xs",children:"Pendiente"})})]},a))})]}),"upload"===e.type&&e.uploadMetadata&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-3",children:"Informacion del archivo"}),(0,r.jsxs)("div",{className:"p-3 bg-[var(--color-surface-hover)] rounded-lg space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"Nombre del archivo"}),(0,r.jsx)("span",{className:"text-[var(--color-text-primary)]",children:e.uploadMetadata.fileName})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"Subido por"}),(0,r.jsxs)("span",{className:"text-[var(--color-text-primary)]",children:[e.uploadMetadata.uploadedByName,"sovra"===e.uploadMetadata.uploadedBy?" (Sovra)":" (Partner)"]})]}),e.uploadMetadata.verificationStatus&&(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-[var(--color-text-secondary)]",children:"Estado de verificacion"}),(0,r.jsx)(u.Badge,{variant:"verified"===e.uploadMetadata.verificationStatus?"success":"rejected"===e.uploadMetadata.verificationStatus?"destructive":"warning",children:"verified"===e.uploadMetadata.verificationStatus?"Verificado":"rejected"===e.uploadMetadata.verificationStatus?"Rechazado":"Pendiente"})]})]})]}),l.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-[var(--color-text-primary)] mb-3",children:"Historial"}),(0,r.jsx)("div",{className:"space-y-3",children:l.map(e=>{var a;let t=(e=>{switch(e){case"created":case"uploaded":default:return d.FileText;case"signed":return c.CheckCircle;case"sent_for_signature":return i.Clock;case"declined":case"rejected":return n.AlertTriangle;case"verified":return F.Shield}})(e.action);return(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"h-8 w-8 rounded-full bg-[var(--color-surface-hover)] flex items-center justify-center",children:(0,r.jsx)(t,{className:"h-4 w-4 text-[var(--color-text-secondary)]"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("p",{className:"text-sm text-[var(--color-text-primary)]",children:[{created:"Documento creado",uploaded:"Documento subido",signed:"Firmado",sent_for_signature:"Enviado para firma",viewed:"Visualizado",downloaded:"Descargado",declined:"Rechazado",rejected:"Rechazado",expired:"Expirado",archived:"Archivado",new_version_created:"Nueva version creada",verified:"Verificado"}[a=e.action]||a,e.actorName&&(0,r.jsxs)("span",{className:"text-[var(--color-text-secondary)]",children:[" - ",e.actorName]})]}),(0,r.jsx)("p",{className:"text-xs text-[var(--color-text-secondary)]",children:y(e.timestamp)})]})]},e.id)})})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-[var(--color-border)]",children:[S&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>w(!1),children:"Rechazar"}),(0,r.jsxs)(x.Button,{onClick:()=>w(!0),children:[(0,r.jsx)(c.CheckCircle,{className:"h-4 w-4 mr-2"}),"Verificar"]})]}),"docusign"===e.type&&e.docusignMetadata?.certificateUrl&&(0,r.jsxs)(x.Button,{variant:"outline",children:[(0,r.jsx)(F.Shield,{className:"h-4 w-4 mr-2"}),"Descargar Certificado"]}),(0,r.jsxs)(x.Button,{variant:"outline",children:[(0,r.jsx)(k.Download,{className:"h-4 w-4 mr-2"}),"Descargar"]})]})]})})}):null}let T={draft:{color:"text-[var(--color-text-secondary)]",bgColor:"bg-[var(--color-surface-hover)]",label:"Borrador"},pending_signature:{color:"text-amber-500",bgColor:"bg-amber-500/10",label:"Pendiente Firma"},partially_signed:{color:"text-[var(--color-primary)]",bgColor:"bg-[var(--color-primary)]/10",label:"Parcialmente Firmado"},active:{color:"text-green-500",bgColor:"bg-green-500/10",label:"Activo"},expired:{color:"text-red-500",bgColor:"bg-red-500/10",label:"Expirado"},superseded:{color:"text-[var(--color-text-muted)]",bgColor:"bg-[var(--color-surface-hover)]",label:"Reemplazado"},archived:{color:"text-[var(--color-text-muted)]",bgColor:"bg-[var(--color-surface-hover)]",label:"Archivado"}},z={contract:"Contrato",amendment:"Addendum",compliance:"Compliance",financial:"Financiero",certification:"Certificacion",policy:"Politica",correspondence:"Correspondencia"};function M(){let[e,l]=(0,a.useState)([]),[c,i]=(0,a.useState)(null),[n,u]=(0,a.useState)([]),[h,f]=(0,a.useState)(!0),[g,j]=(0,a.useState)(""),[b,y]=(0,a.useState)("all"),[N,C]=(0,a.useState)("all"),[S,k]=(0,a.useState)(!1),[P,F]=(0,a.useState)(!1),[E,B]=(0,a.useState)(null);(0,a.useEffect)(()=>{!async function(){try{let e=await fetch("/api/sovra/partners");if(e.ok){let r=await e.json();l(r.partners||[])}}catch(e){console.error("Failed to fetch partners:",e)}finally{f(!1)}}()},[]);let M=(0,a.useCallback)(async()=>{if(!c)return void u([]);try{let e=await fetch(`/api/sovra/documents?partnerId=${c.id}`);if(e.ok){let r=await e.json();u(r.documents||[])}}catch(e){console.error("Failed to fetch documents:",e)}},[c]);(0,a.useEffect)(()=>{M()},[M]);let R=n.filter(e=>{if(g){let r=g.toLowerCase();if(!e.title.toLowerCase().includes(r)&&!e.description?.toLowerCase().includes(r))return!1}return("all"===b||e.category===b)&&("all"===N||e.status===N)}),L=R.filter(e=>"pending_signature"===e.status||"partially_signed"===e.status||"upload"===e.type&&e.uploadMetadata?.verificationStatus==="pending"),_=R.filter(e=>"active"===e.status&&("upload"!==e.type||e.uploadMetadata?.verificationStatus!=="pending")),$=R.filter(e=>!L.includes(e)&&!_.includes(e)),X=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return h?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsx)(v.SovraLoader,{size:"md",className:"text-[var(--color-primary)]"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:["Documentos ",(0,r.jsx)("span",{className:"text-[var(--color-primary)]",children:"Legales"})]}),(0,r.jsx)("p",{className:"text-[var(--color-text-secondary)]",children:"Gestiona documentos y contratos de partners"})]}),(0,r.jsx)(p.Card,{children:(0,r.jsxs)(p.CardContent,{className:"p-4",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-[var(--color-text-primary)] mb-2",children:[(0,r.jsx)(m.Users,{className:"inline h-4 w-4 mr-2"}),"Seleccionar Partner"]}),(0,r.jsxs)("select",{value:c?.id||"",onChange:r=>{i(e.find(e=>e.id===r.target.value)||null)},className:"w-full md:w-96 px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,r.jsx)("option",{value:"",children:"-- Selecciona un partner --"}),e.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.companyName," (",e.name,")"]},e.id))]}),c&&(0,r.jsxs)("div",{className:"mt-2 text-xs text-[var(--color-text-secondary)]",children:["Partner ID: ",(0,r.jsx)("code",{className:"bg-[var(--color-surface-hover)] px-1 py-0.5 rounded",children:c.id})," • ","Tier: ",(0,r.jsx)("span",{className:"capitalize",children:c.tier})," • ","Email: ",c.email]})]})}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,r.jsxs)(x.Button,{onClick:()=>F(!0),children:[(0,r.jsx)(o.Send,{className:"h-4 w-4 mr-2"}),"Enviar Contrato DocuSign"]}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>k(!0),children:[(0,r.jsx)(s.Upload,{className:"h-4 w-4 mr-2"}),"Compartir Documento"]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(t.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-[var(--color-text-secondary)]"}),(0,r.jsx)("input",{type:"text",placeholder:"Buscar documentos...",value:g,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-[var(--color-text-muted)]"})]}),(0,r.jsxs)("select",{value:b,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,r.jsx)("option",{value:"all",children:"Todas las categorias"}),Object.entries(z).map(([e,a])=>(0,r.jsx)("option",{value:e,children:a},e))]}),(0,r.jsxs)("select",{value:N,onChange:e=>C(e.target.value),className:"px-3 py-2 border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text-primary)] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]",children:[(0,r.jsx)("option",{value:"all",children:"Todos los estados"}),Object.entries(T).map(([e,a])=>(0,r.jsx)("option",{value:e,children:a.label},e))]})]}),0===R.length?(0,r.jsx)(p.Card,{children:(0,r.jsxs)(p.CardContent,{className:"py-12 text-center",children:[(0,r.jsx)(d.FileText,{className:"mx-auto h-12 w-12 text-[var(--color-text-muted)]"}),(0,r.jsx)("p",{className:"mt-4 text-[var(--color-text-secondary)]",children:0===n.length?"No hay documentos para este partner":"No se encontraron documentos con los filtros aplicados"})]})}):(0,r.jsxs)("div",{className:"space-y-6",children:[L.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"h-2 w-2 rounded-full bg-amber-500"}),"Requieren Accion (",L.length,")"]}),(0,r.jsx)("div",{className:"space-y-2",children:L.map(e=>(0,r.jsx)(O,{document:e,onView:()=>B(e),onRefresh:M,formatDate:X},e.id))})]}),_.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-500"}),"Documentos Activos (",_.length,")"]}),(0,r.jsx)("div",{className:"space-y-2",children:_.map(e=>(0,r.jsx)(O,{document:e,onView:()=>B(e),onRefresh:M,formatDate:X},e.id))})]}),$.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-[var(--color-text-primary)] mb-3 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"h-2 w-2 rounded-full bg-[var(--color-text-muted)]"}),"Otros (",$.length,")"]}),(0,r.jsx)("div",{className:"space-y-2",children:$.map(e=>(0,r.jsx)(O,{document:e,onView:()=>B(e),onRefresh:M,formatDate:X},e.id))})]})]})]}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{isOpen:S,onClose:()=>k(!1),partner:c,onSuccess:()=>{k(!1),M()}}),(0,r.jsx)(D,{isOpen:P,onClose:()=>F(!1),partner:c,onSuccess:()=>{F(!1),M()}})]}),E&&(0,r.jsx)(A,{document:E,isOpen:!!E,onClose:()=>B(null),onRefresh:M})]})}function O({document:e,onView:a,onRefresh:t,formatDate:o}){let s=T[e.status],m="upload"===e.type&&e.uploadMetadata?.verificationStatus==="pending",v=async r=>{try{(await fetch(`/api/sovra/documents/${e.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:r?"verified":"rejected",notes:r?"Documento verificado por admin":"Documento rechazado por admin"})})).ok&&t()}catch(e){console.error("Failed to verify document:",e)}};return(0,r.jsx)(p.Card,{className:"hover:shadow-md transition-shadow",children:(0,r.jsx)(p.CardContent,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:(0,h.cn)("h-10 w-10 rounded-lg flex items-center justify-center",s.bgColor),children:"active"===e.status?(0,r.jsx)(c.CheckCircle,{className:(0,h.cn)("h-5 w-5",s.color)}):"pending_signature"===e.status||"partially_signed"===e.status?(0,r.jsx)(i.Clock,{className:(0,h.cn)("h-5 w-5",s.color)}):"expired"===e.status?(0,r.jsx)(n.AlertTriangle,{className:(0,h.cn)("h-5 w-5",s.color)}):(0,r.jsx)(d.FileText,{className:(0,h.cn)("h-5 w-5",s.color)})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"font-medium text-[var(--color-text-primary)] truncate",children:e.title}),e.version>1&&(0,r.jsxs)("span",{className:"text-xs text-[var(--color-text-secondary)]",children:["v",e.version]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[(0,r.jsx)(u.Badge,{variant:"secondary",className:"text-xs",children:z[e.category]}),(0,r.jsx)(u.Badge,{variant:"docusign"===e.type?"outline":"secondary",className:"text-xs",children:"docusign"===e.type?"DocuSign":"Subido"}),m&&(0,r.jsx)(u.Badge,{variant:"warning",className:"text-xs",children:"Pendiente Verificacion"})]}),(0,r.jsxs)("p",{className:"text-sm text-[var(--color-text-secondary)] mt-1",children:[e.createdAt&&`Creado: ${o(e.createdAt)}`,e.expirationDate&&` | Expira: ${o(e.expirationDate)}`]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.Button,{size:"sm",onClick:()=>v(!0),children:[(0,r.jsx)(c.CheckCircle,{className:"h-4 w-4 mr-1"}),"Verificar"]}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>v(!1),children:"Rechazar"})]}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:a,children:(0,r.jsx)(l.Eye,{className:"h-4 w-4"})})]})]})})})}e.s(["default",()=>M],58724)}]);